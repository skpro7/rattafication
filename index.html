<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#d80f01af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RATTAFICATION">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="Smart Exam Preparation with Spaced Repetition for RRB, SSC, Banking">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-touch-fullscreen" content="yes">
    <title>RATTAFICATION - Smart Exam Preparation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23d80f01af' width='180' height='180'/><text x='50%' y='50%' font-size='80' fill='white' text-anchor='middle' dy='.3em' font-weight='bold'>R</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #d80f01af;
            --primary-light: #e0e7ff;
            --secondary: #254e67;
            --accent: #d19900;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #26435e;
            --card-bg: rgba(238, 240, 233, 0.85);
            --sidebar-bg: rgba(201, 225, 249, 0.95);
            --border: #066e20;
            --text: #2a405e;
            --text-light: #64748b;
        }
        .dark-theme {
            --primary: #efc048fb;
            --primary-light: #122e58;
            --secondary: #2e1764;
            --accent: #c16f23;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #4895ef;
            --light: rgba(21, 48, 59, 0.85);
            --dark: #aea2a2;
            --card-bg: rgba(15, 27, 44, 0.85);
            --sidebar-bg: rgba(14, 26, 36, 0.95);
            --border: #c26363;
            --text: #ffffff !important;
            --text-light: #e0e0e0 !important;
        }
        .semi-dark-theme {
            --primary: #2ec0cd;
            --primary-light: #334155;
            --secondary: #5dc6be;
            --accent: #2973afd7;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #4895ef;
            --light: rgba(30, 41, 59, 0.85);
            --dark: #f8f9fa;
            --card-bg: rgba(64, 70, 89, 0.85);
            --sidebar-bg: rgba(30, 41, 59, 0.95);
            --border: #475569;
            --text: #ffffff !important;
            --text-light: #c0e0ff !important;
        }
        .colorful-theme {
            --primary: #e61818;
            --primary-light: #dce1a0;
            --secondary: #45c0b8;
            --accent: #4a1a67d6;
            --success: #06d6a0;
            --warning: #ff0400;
            --info: #118ab2;
            --light: rgba(252, 208, 222, 0.85);
            --dark: #212529;
            --card-bg: rgba(255, 251, 241, 0.85);
            --sidebar-bg: rgba(255, 235, 144, 0.95);
            --border: #8e6f01;
            --text: #0b4216 !important;
            --text-light: #27305e !important;
        }
        .ocean-theme {
            --primary: #55aaff;
            --primary-light: #e8f0fe;
            --secondary: #0d47a1;
            --accent: #00bcd4;
            --success: #0f9d58;
            --warning: #fc4333;
            --info: #64c6de;
            --light: rgba(210, 226, 255, 0.85);
            --dark: #212529;
            --card-bg: rgba(198, 234, 251, 0.85);
            --sidebar-bg: rgba(173, 227, 245, 0.95);
            --border: #152131;
            --text: #334155 !important;
            --text-light: #64748b !important;
        }
        .light-theme {
            --primary: #4361ee;
            --primary-light: #f0f4ff;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #4895ef;
            --light: #ffffff;
            --dark: #26435e;
            --card-bg: rgba(255, 255, 255, 0.95);
            --sidebar-bg: rgba(255, 255, 255, 0.95);
            --border: #e2e8f0;
            --text: #1e293b !important;
            --text-light: #64748b !important;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            background: var(--light);
            color: var(--text);
            min-height: 100vh;
            height: 100dvh;
            overflow-x: hidden;
            transition: all 0.3s ease;
            position: relative;
            touch-action: manipulation;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-font-smoothing: antialiased;
            -webkit-text-size-adjust: 100%;
        }
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
                padding-top: max(0px, env(safe-area-inset-top));
                padding-bottom: max(0px, env(safe-area-inset-bottom));
            }
        }
        html {
            touch-action: manipulation;
        }
        input, textarea, select {
            font-size: 16px !important;
            -webkit-appearance: none;
            appearance: none;
            border-radius: 8px;
            padding: 12px;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        button, .btn, a[role="button"] {
            min-height: 48px;
            min-width: 48px;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
            user-select: none;
        }
        button, .btn {
            touch-action: manipulation;
        }
        h1, h2, h3, h4, h5, h6, p, span, div, li, a, button, input, select, textarea, label {
            color: var(--text);
        }
        .light-theme body {
            background: #ffffff;
        }
        .theme-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            pointer-events: none;
        }
        .light-theme-bg {
            background: linear-gradient(135deg, #f0f4ff 0%, #e2e8f0 100%);
        }
        .light-theme-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(238, 243, 250, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 255, 200, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(242, 191, 250, 0.2) 0%, transparent 50%);
            animation: sunRays 20s infinite linear;
        }
        @keyframes sunRays {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .dark-theme-bg {
            background: linear-gradient(135deg, #090d18 0%, #1a1a2e 100%);
        }
        .dark-theme-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 20px 30px, #eee, transparent),
                radial-gradient(2px 2px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #ddd, transparent),
                radial-gradient(1px 1px at 130px 80px, #fff, transparent),
                radial-gradient(2px 2px at 160px 30px, #eee, transparent),
                radial-gradient(1px 1px at 200px 70px, #fff, transparent),
                radial-gradient(1px 1px at 240px 40px, #ddd, transparent),
                radial-gradient(2px 2px at 280px 80px, #fff, transparent),
                radial-gradient(1px 1px at 320px 30px, #eee, transparent),
                radial-gradient(2px 2px at 360px 70px, #fff, transparent),
                radial-gradient(1px 1px at 400px 40px, #ddd, transparent),
                radial-gradient(2px 2px at 440px 80px, #fff, transparent);
            background-repeat: repeat;
            background-size: 500px 500px;
            animation: stars 120s linear infinite;
        }
        @keyframes stars {
            from { transform: translateX(0); }
            to { transform: translateX(-500px); }
        }
        .semi-dark-theme-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .semi-dark-theme-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(3px 3px at 50px 50px, rgba(255,255,255,0.3), transparent),
                radial-gradient(2px 2px at 150px 150px, rgba(255,255,255,0.2), transparent),
                radial-gradient(4px 4px at 250px 250px, rgba(255,255,255,0.25), transparent),
                radial-gradient(3px 3px at 350px 350px, rgba(255,255,255,0.3), transparent);
            animation: floatParticles 30s infinite linear;
        }
        @keyframes floatParticles {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        .colorful-theme-bg {
            background: linear-gradient(135deg, #ffffffdd 0%, #6acf53 100%);
        }
        .colorful-theme-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(30px 30px at 10% 10%, rgba(255,255,255,0.2), transparent),
                radial-gradient(40px 40px at 90% 20%, rgba(255,255,255,0.15), transparent),
                radial-gradient(50px 50px at 20% 80%, rgba(255,255,255,0.1), transparent),
                radial-gradient(60px 60px at 80% 90%, rgba(255,255,255,0.25), transparent);
            animation: floatingShapes 40s infinite linear;
        }
        @keyframes floatingShapes {
            0% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -20px) rotate(120deg); }
            66% { transform: translate(-20px, 15px) rotate(240deg); }
            100% { transform: translate(0, 0) rotate(360deg); }
        }
        .ocean-theme-bg {
            background: linear-gradient(135deg, #002451 0%, #091539 100%);
        }
        .ocean-theme-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.1) 50%, transparent 100%);
            background-size: 200% 100%;
            animation: waves 15s infinite linear;
        }
        @keyframes waves {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .bg-illustration {
            position: fixed;
            z-index: -1;
            pointer-events: none;
            animation: float 6s ease-in-out infinite;
        }
        .light-theme .bg-illustration {
            opacity: 0.1;
        }
        .dark-theme .bg-illustration,
        .semi-dark-theme .bg-illustration {
            opacity: 0.15;
        }
        .colorful-theme .bg-illustration,
        .ocean-theme .bg-illustration {
            opacity: 0.12;
        }
        .illustration-1 {
            top: 5%;
            left: 5%;
            font-size: 8rem;
            color: var(--primary);
            animation-delay: 0s;
        }
        .illustration-2 {
            top: 15%;
            right: 10%;
            font-size: 6rem;
            color: var(--accent);
            animation-delay: 1s;
        }
        .illustration-3 {
            bottom: 10%;
            left: 10%;
            font-size: 7rem;
            color: var(--success);
            animation-delay: 2s;
        }
        .illustration-4 {
            bottom: 20%;
            right: 5%;
            font-size: 5rem;
            color: var(--warning);
            animation-delay: 3s;
        }
        .pattern-dots {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: radial-gradient(var(--primary) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }
        .doodle {
            position: fixed;
            z-index: -1;
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }
        .light-theme .doodle {
            opacity: 0.08;
        }
        .dark-theme .doodle,
        .semi-dark-theme .doodle {
            opacity: 0.15;
        }
        .colorful-theme .doodle,
        .ocean-theme .doodle {
            opacity: 0.12;
        }
        .doodle-1 {
            top: 30%;
            left: 8%;
            font-size: 5rem;
            transform: rotate(15deg);
            color: var(--accent);
            animation-delay: 0.5s;
        }
        .doodle-2 {
            top: 60%;
            right: 12%;
            font-size: 4rem;
            transform: rotate(-10deg);
            color: var(--warning);
            animation-delay: 1.5s;
        }
        .doodle-3 {
            top: 40%;
            right: 5%;
            font-size: 6rem;
            transform: rotate(25deg);
            color: var(--success);
            animation-delay: 2.5s;
        }
        .floating-shapes {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        .shape {
            position: absolute;
            border-radius: 50%;
            background: var(--primary);
            animation: float 15s infinite linear;
        }
        .light-theme .shape {
            opacity: 0.04;
        }
        .dark-theme .shape,
        .semi-dark-theme .shape {
            opacity: 0.08;
        }
        .colorful-theme .shape,
        .ocean-theme .shape {
            opacity: 0.06;
        }
        .shape-1 {
            width: 200px;
            height: 200px;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }
        .shape-2 {
            width: 150px;
            height: 150px;
            top: 60%;
            right: 10%;
            animation-delay: 5s;
        }
        .shape-3 {
            width: 100px;
            height: 100px;
            bottom: 20%;
            left: 15%;
            animation-delay: 10s;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes slideIn {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px rgba(67, 97, 238, 0.5); }
            50% { box-shadow: 0 0 20px rgba(67, 97, 238, 0.8); }
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
            animation: slideIn 0.8s ease-out;
            position: relative;
            overflow: hidden;
        }
        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        header:hover::before {
            left: 100%;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
            transform: rotate(-5deg);
            background: var(--primary-light);
            padding: 10px;
            border-radius: 12px;
            animation: pulse 2s infinite;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .logo-icon img {
            width: 130%;
            height: 130%;
            object-fit: contain;
            border-radius: 10px;
        }
        .logo-text {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            position: relative;
        }
        .logo-text::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s;
        }
        .logo:hover .logo-text::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .welcome-content {
            text-align: center;
            max-width: 800px;
            width: 100%;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            margin: 20px auto;
            max-height: 90vh;
            overflow-y: auto;
        }
        .welcome-content::-webkit-scrollbar {
            width: 6px;
        }
        .welcome-content::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }
        .welcome-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        .welcome-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        .welcome-title {
            font-size: 3rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: slideIn 1s ease-out;
        }
        .welcome-subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: var(--text);
            animation: slideIn 1.2s ease-out;
        }
        .slideshow-container {
            width: 100%;
            height: 200px;
            position: relative;
            margin-bottom: 30px;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background: var(--light);
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .slide.active {
            opacity: 1;
        }
        .slide-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        .slide-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text);
        }
        .slide-content {
            color: var(--text-light);
            text-align: center;
            max-width: 80%;
        }
        .avatar-selection {
            margin-bottom: 30px;
            width: 100%;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary-light) 0%, transparent 100%);
            border-radius: 15px;
            border: 2px solid var(--primary);
        }
        .avatar-selection-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--primary);
            font-weight: 700;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .avatar-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .avatar-btn {
            padding: 18px 35px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.35), 0 3px 8px rgba(0, 0, 0, 0.15);
            min-width: 190px;
            justify-content: center;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }
        .avatar-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s ease;
            z-index: 1;
        }
        .avatar-btn::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50px;
            padding: 2px;
            background: linear-gradient(135deg, rgba(255,255,255,0.5), rgba(255,255,255,0.1));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        .avatar-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(67, 97, 238, 0.45), 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        .avatar-btn:hover::before {
            left: 100%;
        }
        .avatar-btn:hover::after {
            opacity: 1;
        }
        .avatar-btn:active {
            transform: translateY(-2px) scale(0.98);
        }
        .avatar-btn i {
            font-size: 1.2rem;
            position: relative;
            z-index: 2;
        }
        .avatar-preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 25px 0;
            gap: 15px;
        }
        .avatar-preview {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--light) 0%, var(--primary-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
            border: 5px solid var(--primary);
            overflow: hidden;
            box-shadow: 0 12px 35px rgba(67, 97, 238, 0.3), inset 0 2px 4px rgba(255,255,255,0.8);
            position: relative;
            transition: all 0.3s ease;
        }
        .avatar-preview::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
            z-index: 1;
            pointer-events: none;
        }
        .avatar-preview:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 45px rgba(67, 97, 238, 0.4), inset 0 2px 4px rgba(255,255,255,0.8);
        }
        .avatar-preview i {
            font-size: 4.5rem;
            color: var(--primary);
            position: relative;
            z-index: 2;
        }
        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: relative;
            z-index: 2;
        }
        .avatar-selected-text {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.15rem;
            text-align: center;
            letter-spacing: 0.3px;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .icon-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .icon-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .icon-modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .icon-modal.active .icon-modal-content {
            transform: translateY(0);
        }
        .icon-modal-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
        }
        .icon-grid-modal {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .icon-option-modal {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            font-size: 2rem;
            background: var(--light);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transform: perspective(500px) translateZ(0);
        }
        .icon-option-modal:hover {
            transform: perspective(500px) translateZ(20px) scale(1.1);
            border-color: var(--primary);
        }
        .icon-option-modal.selected {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.3), 0 6px 12px rgba(0,0,0,0.15);
            transform: perspective(500px) translateZ(20px) scale(1.1);
        }
        .icon-modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .icon-modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .icon-modal-btn.cancel {
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        .icon-modal-btn.confirm {
            background: var(--primary);
            color: white;
        }
        .icon-modal-btn:hover {
            transform: translateY(-2px);
        }
        .name-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.3s ease;
            animation: slideIn 1.4s ease-out;
        }
        .name-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            animation: glow 2s infinite;
        }
        .start-btn {
            padding: 15px 40px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
            animation: slideIn 1.6s ease-out;
            position: relative;
            overflow: hidden;
        }
        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .start-btn:hover::before {
            left: 100%;
        }
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.6);
        }
        .cropper-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        .cropper-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .cropper-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 35px;
            max-width: 550px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 1px rgba(0, 0, 0, 0.5);
            transform: translateY(30px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid var(--primary);
        }
        .cropper-modal.active .cropper-content {
            transform: translateY(0) scale(1);
        }
        .cropper-title {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .cropper-zoom-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: 12px;
            flex-wrap: wrap;
        }
        .zoom-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        .zoom-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(67, 97, 238, 0.4);
        }
        .zoom-btn:active {
            transform: scale(0.95);
        }
        .zoom-level {
            font-weight: 700;
            color: var(--primary);
            min-width: 70px;
            text-align: center;
            font-size: 1.1rem;
        }
        .zoom-slider {
            width: 150px;
            height: 6px;
            border-radius: 5px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
        }
        .zoom-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(67, 97, 238, 0.3);
        }
        .cropper-container {
            width: 100%;
            height: 350px;
            margin: 25px 0;
            background: linear-gradient(135deg, var(--light) 0%, var(--primary-light) 100%);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 2px solid var(--primary);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05), 0 8px 24px rgba(67, 97, 238, 0.2);
            cursor: grab;
            user-select: none;
            -webkit-user-select: none;
        }
        .cropper-container:active {
            cursor: grabbing;
        }
        .cropper-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            transform-origin: center;
            transition: transform 0.2s ease;
            cursor: grab;
            position: relative;
        }
        .cropper-image:active {
            cursor: grabbing;
        }
        .cropper-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            pointer-events: none;
            box-shadow: 0 0 0 2000px rgba(0, 0, 0, 0.65), inset 0 0 20px rgba(255, 255, 255, 0.3);
            z-index: 10;
            transition: all 0.3s ease;
        }
        .cropper-circle::before {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 50%;
            border: 2px dashed rgba(255, 255, 255, 0.5);
            opacity: 0.7;
        }
        .cropper-circle::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            box-shadow: inset 0 0 15px rgba(67, 97, 238, 0.3), 0 0 20px rgba(67, 97, 238, 0.5);
        }
        .crop-instructions {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(67, 97, 238, 0.9);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 15;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            pointer-events: none;
            white-space: nowrap;
        }
        .cropper-controls {
            display: flex;
            gap: 12px;
            margin-top: 25px;
        }
        .cropper-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.05rem;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        .cropper-btn.cancel {
            background: var(--light);
            color: var(--text);
            border: 2px solid var(--border);
        }
        .cropper-btn.cancel:hover {
            background: var(--border);
            color: white;
            transform: translateY(-2px);
        }
        .cropper-btn.confirm {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }
        .cropper-btn.confirm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        .cropper-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
        }
        .cropper-btn.confirm:hover::before {
            left: 100%;
        }
        .cropper-btn:active {
            transform: translateY(0);
        }
        .app-content {
            display: none;
        }
        .user-greeting-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            animation: slideIn 0.8s ease-out;
        }
        .user-avatar-small {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            overflow: hidden;
            flex-shrink: 0;
        }
        .user-avatar-small i {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .user-avatar-small img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-greeting {
            font-size: 1.5rem;
            color: var(--primary);
        }
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideIn 0.8s ease-out;
        }
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .card-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title i {
            font-size: 1.5rem;
        }
        .calendar-container {
            margin-bottom: 30px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        .calendar-nav button {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .calendar-nav button:hover {
            background: var(--primary);
            color: white;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--light);
            border-radius: 5px;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
            font-size: 0.8rem;
            padding: 2px;
        }
        .calendar-day:hover {
            background: var(--primary-light);
            transform: scale(1.05);
        }
        .calendar-day.current {
            background: var(--primary-light);
            border: 1px solid var(--primary);
        }
        .calendar-day.revision {
            background: rgba(114, 9, 183, 0.1);
            border: 1px solid var(--accent);
        }
        .day-number {
            font-size: 0.9rem;
            font-weight: 600;
        }
        .revision-dots {
            display: flex;
            gap: 2px;
            margin-top: 2px;
        }
        .revision-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }
        .dot-math { background: #4cc9f0; }
        .dot-reasoning { background: #f72585; }
        .dot-english { background: #4895ef; }
        .dot-gk { background: #7209b7; }
        .dot-computer { background: #3a0ca3; }
        .dot-banking { background: #38b000; }
        .dot-custom { background: #6c757d; }
        .add-topic-section {
            margin-bottom: 30px;
        }
        .topic-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary);
        }
        .input-container {
            display: flex;
            background: var(--light);
            border-radius: 1rem;
            box-shadow: 4px 4px 8px rgba(0,0,0,0.1), -4px -4px 10px rgba(255,255,255,0.5);
            padding: 0.3rem;
            gap: 0.3rem;
        }
        .form-select, .form-input {
            border-radius: 0.8rem 0 0 0.8rem;
            background: var(--light);
            box-shadow: inset 5px 5px 10px rgba(0,0,0,0.05), inset -5px -5px 10px rgba(255,255,255,0.5);
            width: 100%;
            flex-basis: 75%;
            padding: 1rem;
            border: none;
            border: 1px solid transparent;
            color: var(--text);
            transition: all 0.2s ease-in-out;
        }
        .form-select:focus, .form-input:focus {
            border: 1px solid var(--primary);
            outline: none;
            box-shadow: inset 0px 0px 10px rgba(67, 97, 238, 0.2), 0px 0px 10px rgba(67, 97, 238, 0.2);
        }
        .add-btn {
            grid-column: span 2;
            padding: 15px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .add-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .add-btn:hover::before {
            left: 100%;
        }
        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.4);
        }
        .progress-container {
            height: 260px;
            margin-top: 15px;
        }
        .tips-section {
            margin-top: 40px;
        }
        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .tip-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        .tip-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }
        .tip-icon {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        .tip-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .tip-content {
            color: var(--text-light);
            line-height: 1.5;
        }
        .todo-section {
            margin-top: 40px;
        }
        .todo-list {
            list-style: none;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .todo-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--light);
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        .todo-item:hover {
            background: var(--primary-light);
        }
        .todo-checkbox {
            width: 22px;
            height: 22px;
            min-width: 22px;
            min-height: 22px;
            cursor: pointer;
            accent-color: var(--primary);
            flex-shrink: 0;
            appearance: auto;
            -webkit-appearance: auto;
            -moz-appearance: auto;
        }
        .todo-checkbox:checked {
            accent-color: var(--success);
        }
        .todo-item input[type="checkbox"]:checked + .todo-content .todo-topic {
            text-decoration: line-through;
            opacity: 0.7;
            color: var(--text-light);
        }
        .todo-item input[type="checkbox"]:checked + .todo-content {
            opacity: 0.8;
        }
        .todo-content {
            flex: 1;
            cursor: pointer;
        }
        .todo-subject {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }
        .todo-topic {
            font-weight: 600;
        }
        .todo-revision {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        .todo-date {
            font-size: 0.8rem;
            color: var(--text-light);
        }
        .todo-item.past-due {
            border-left: 4px solid var(--warning);
        }
        .todo-item.future {
            opacity: 0.7;
        }
        .todo-item.future .todo-checkbox {
            pointer-events: none;
            opacity: 0.5;
        }
        .delete-topic-btn {
            background: none;
            border: none;
            color: var(--warning);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        .delete-topic-btn:hover {
            background: var(--warning);
            color: white;
            transform: scale(1.1);
        }
        .backlog-section.hidden {
            display: none;
        }
        .drawer {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100%;
            background: var(--sidebar-bg);
            padding: 20px;
            transition: right 0.3s ease;
            z-index: 100;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            border-left: 1px solid var(--border);
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        .drawer.open {
            right: 0;
        }
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
            position: relative;
        }
        .drawer-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            padding: 20px;
        }
        .settings-modal.active {
            opacity: 1;
            visibility: visible;
        }
        body.settings-open {
            overflow: hidden !important;
            height: 100vh;
        }
        .settings-content {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 0;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid var(--primary);
        }
        .settings-modal.active .settings-content {
            transform: scale(1) translateY(0);
        }
        .settings-section {
            margin-bottom: 0;
            padding: 28px 24px;
            border-bottom: 1px solid var(--border);
        }
        .settings-section:first-of-type {
            border-radius: 24px 24px 0 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }
        .settings-section:first-of-type .settings-title {
            color: white;
            font-size: 1.4rem;
        }
        .settings-section:last-of-type {
            border-bottom: none;
            border-radius: 0 0 24px 24px;
        }
        .settings-title {
            font-size: 1.2rem;
            margin-bottom: 18px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 14px;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .settings-title i {
            font-size: 1.3rem;
        }
        .theme-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 14px;
            margin-top: 18px;
        }
        .theme-option {
            padding: 16px 10px;
            border-radius: 14px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: capitalize;
            position: relative;
            overflow: hidden;
        }
        .theme-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.25);
        }
        .theme-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(67, 97, 238, 0.4);
            transform: scale(1.08);
        }
        .theme-light {
            background: linear-gradient(135deg, #f0f4ff 0%, #a4fdc0 100%);
            color: #334155;
        }
        .theme-dark {
            background: linear-gradient(135deg, #090d18 0%, #685321 100%);
            color: #ffffff;
        }
        .theme-semi-dark {
            background: linear-gradient(135deg, #1e293b 0%, #335b94 100%);
            color: #e2e8f0;
        }
        .theme-colorful {
            background: linear-gradient(135deg, #ff6b6b 0%, #d99c22 100%);
            color: #334155;
        }
        .theme-ocean {
            background: linear-gradient(135deg, #1a73e8 0%, #00bcd4 100%);
            color: white;
        }
        .time-setting {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 16px;
            padding: 14px 16px;
            background: var(--light);
            border-radius: 12px;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }
        .time-setting:hover {
            border-color: var(--primary);
        }
        .time-input {
            padding: 12px 16px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 1rem;
            width: 150px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .time-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(67, 97, 238, 0.2);
            outline: none;
        }
        .time-label {
            font-weight: 700;
            color: var(--text);
            white-space: nowrap;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .notification-info {
            background: var(--light);
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 16px;
            border-left: 4px solid var(--primary);
        }
        .notification-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
            line-height: 1.4;
        }
        .notification-features {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
            margin-bottom: 18px;
        }
        .feature-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text);
        }
        .feature-item i {
            color: var(--primary);
            font-size: 1.1rem;
        }
        .user-settings {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 12px;
        }
        .user-avatar-section {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: var(--light);
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .user-avatar-settings {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid white;
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.35);
            overflow: hidden;
            cursor: pointer;
            flex-shrink: 0;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        .user-avatar-settings:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.45);
        }
        .user-avatar-settings i {
            font-size: 2.2rem;
            color: white;
        }
        .user-avatar-settings img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-name-input {
            padding: 14px 18px;
            border-radius: 10px;
            border: 2px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
        }
        .user-name-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
        .user-name-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 12px rgba(67, 97, 238, 0.25);
            background: var(--card-bg);
        }
        .settings-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-top: 14px;
            width: 100%;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.6px;
            box-shadow: 0 6px 18px rgba(67, 97, 238, 0.35);
            font-size: 0.95rem;
            text-transform: uppercase;
        }
        .settings-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
        }
        .settings-btn:hover::before {
            left: 100%;
        }
        .settings-btn:active {
            transform: translateY(0);
        }
        .close-settings {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .danger-zone {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%) !important;
            border: 2px solid #ef4444 !important;
            border-radius: 12px !important;
            margin-top: 20px !important;
        }
        .danger-title {
            color: #ef4444 !important;
        }
        .danger-warning {
            color: #dc2626;
            font-size: 0.95rem;
            margin: 15px 0;
            padding: 12px;
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            border-radius: 4px;
            font-weight: 500;
        }
        .reset-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%) !important;
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3) !important;
        }
        .reset-btn:hover {
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5) !important;
        }
        .reset-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }
        .reset-confirm-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .reset-confirm-content {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .reset-confirm-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ef4444;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .reset-confirm-header i {
            font-size: 2rem;
        }
        .reset-confirm-message {
            color: var(--text);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(239, 68, 68, 0.05);
            border-radius: 8px;
            border-left: 4px solid #ef4444;
        }
        .reset-confirm-message strong {
            color: #ef4444;
            font-weight: 700;
        }
        .reset-confirm-message ul {
            margin: 10px 0 0 20px;
            padding: 0;
        }
        .reset-confirm-message li {
            margin: 5px 0;
            color: var(--text);
        }
        .reset-confirm-instruction {
            color: var(--text);
            font-size: 0.95rem;
            margin-bottom: 15px;
            font-weight: 500;
        }
        .reset-confirm-input {
            width: 100%;
            padding: 14px;
            border: 2px solid #ef4444;
            border-radius: 8px;
            background: var(--light);
            color: var(--text);
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        .reset-confirm-input:focus {
            outline: none;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }
        .reset-confirm-input::placeholder {
            color: var(--text-light);
            letter-spacing: 0;
        }
        .reset-confirm-actions {
            display: flex;
            gap: 12px;
        }
        .reset-confirm-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            min-height: 48px;
        }
        .reset-confirm-btn.cancel {
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        .reset-confirm-btn.cancel:hover {
            background: var(--primary-light);
        }
        .reset-confirm-btn.confirm {
            background: #ef4444;
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
        }
        .reset-confirm-btn.confirm:enabled {
            opacity: 1;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
        }
        .reset-confirm-btn.confirm:enabled:hover {
            background: #dc2626;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
            transform: translateY(-2px);
        }
        .date-topics-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        .date-topics-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .date-topics-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            max-width: 550px;
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
            transform: scale(0.95) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid var(--primary);
            position: relative;
        }
        .date-topics-modal.active .date-topics-content {
            transform: scale(1) translateY(0);
        }
        .close-date-topics {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--light);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text);
            transition: all 0.3s ease;
        }
        .close-date-topics:hover {
            background: var(--primary);
            color: white;
            transform: rotate(90deg);
        }
        .date-topics-header {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 24px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .date-topics-header i {
            font-size: 1.6rem;
        }
        .date-topics-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        .date-topic-item {
            background: var(--light);
            padding: 16px;
            border-radius: 12px;
            border-left: 4px solid;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .date-topic-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(67, 97, 238, 0.15);
        }
        .date-topic-subject {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin-bottom: 6px;
            opacity: 0.7;
        }
        .date-topic-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }
        .date-topic-info {
            display: flex;
            gap: 12px;
            font-size: 0.85rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }
        .date-topic-revision {
            background: var(--card-bg);
            padding: 4px 10px;
            border-radius: 6px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .no-topics-message {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        .no-topics-message i {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }
        .drawer-cancel {
            margin-top: auto;
            padding: 15px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .drawer-cancel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
            transition: left 0.5s;
        }
        .drawer-cancel:hover::before {
            left: 100%;
        }
        .drawer-cancel:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }
        .drawer-menu {
            list-style: none;
            margin-bottom: 30px;
            flex: 1;
        }
        .drawer-menu li {
            margin-bottom: 15px;
        }
        .drawer-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--text);
            text-decoration: none;
            font-size: 1.1rem;
            padding: 10px;
            border-radius: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .drawer-menu a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
            transition: left 0.5s;
        }
        .drawer-menu a:hover::before {
            left: 100%;
        }
        .drawer-menu a:hover {
            background: var(--primary-light);
        }
        .drawer-menu i {
            font-size: 1.3rem;
            width: 30px;
            color: var(--primary);
        }
        .drawer-section {
            margin-bottom: 30px;
        }
        .drawer-section-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            font-weight: 600;
        }
        .drawer-section-content {
            color: var(--text-light);
            line-height: 1.5;
        }
        .contact-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        .contact-link:hover {
            transform: translateX(5px);
        }
        .go-to-menu-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 14px 20px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.3);
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        .go-to-menu-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
            z-index: 1;
        }
        .go-to-menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(67, 97, 238, 0.4);
        }
        .go-to-menu-btn:hover::before {
            left: 100%;
        }
        .go-to-menu-btn:active {
            transform: translateY(-1px);
        }
        .go-to-menu-btn i {
            font-size: 1.1rem;
            transition: transform 0.3s ease;
        }
        .go-to-menu-btn:hover i {
            transform: translateX(-3px);
        }
        .drawer-doodle {
            position: absolute;
            font-size: 3rem;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
            animation: float 10s infinite ease-in-out;
        }
        .drawer-doodle-1 {
            top: 10%;
            right: 10%;
            color: var(--primary);
            animation-delay: 0s;
        }
        .drawer-doodle-2 {
            bottom: 20%;
            left: 10%;
            color: var(--accent);
            animation-delay: 2s;
        }
        .drawer-doodle-3 {
            bottom: 10%;
            right: 20%;
            color: var(--success);
            animation-delay: 4s;
        }
        .menu-btn {
            position: relative;
            margin: 0;
            padding: 10px 15px;
            outline: none;
            text-decoration: none;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-transform: uppercase;
            background-color: var(--light);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--primary);
            font-weight: 400;
            font-family: inherit;
            z-index: 0;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.02, 0.01, 0.47, 1);
        }
        .menu-btn span {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 0.7px;
        }
        .menu-btn:hover {
            animation: rotate624 0.7s ease-in-out both;
        }
        .menu-btn:hover span {
            animation: storm1261 0.7s ease-in-out both;
            animation-delay: 0.06s;
        }
        @keyframes rotate624 {
            0% {
                transform: rotate(0deg) translate3d(0, 0, 0);
            }
            25% {
                transform: rotate(3deg) translate3d(0, 0, 0);
            }
            50% {
                transform: rotate(-3deg) translate3d(0, 0, 0);
            }
            75% {
                transform: rotate(1deg) translate3d(0, 0, 0);
            }
            100% {
                transform: rotate(0deg) translate3d(0, 0, 0);
            }
        }
        @keyframes storm1261 {
            0% {
                transform: translate3d(0, 0, 0) translateZ(0);
            }
            25% {
                transform: translate3d(4px, 0, 0) translateZ(0);
            }
            50% {
                transform: translate3d(-3px, 0, 0) translateZ(0);
            }
            75% {
                transform: translate3d(2px, 0, 0) translateZ(0);
            }
            100% {
                transform: translate3d(0, 0, 0) translateZ(0);
            }
        }
        .btn-shine {
            border: 1px solid;
            overflow: hidden;
            position: relative;
        }
        .btn-shine:after {
            background: var(--accent);
            content: "";
            height: 155px;
            left: -75px;
            opacity: 0.4;
            position: absolute;
            top: -50px;
            transform: rotate(35deg);
            transition: all 550ms cubic-bezier(0.19, 1, 0.22, 1);
            width: 50px;
            z-index: -10;
        }
        .btn-shine:hover:after {
            left: 120%;
            transition: all 550ms cubic-bezier(0.19, 1, 0.22, 1);
        }
        .notification-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .notification-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .notification-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .notification-modal.active .notification-content {
            transform: translateY(0);
        }
        .notification-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        .notification-message {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .notification-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .notification-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .notification-btn.primary {
            background: var(--primary);
            color: white;
        }
        .notification-btn.secondary {
            background: var(--light);
            color: var(--text);
            border: 1px solid var(--border);
        }
        .notification-btn:hover {
            transform: translateY(-2px);
        }
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .share-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .share-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .share-modal.active .share-content {
            transform: translateY(0);
        }
        .share-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            text-align: center;
        }
        .share-promo {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border);
        }
        .share-promo-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        .share-promo-text {
            color: var(--text);
            line-height: 1.5;
            font-size: 0.95rem;
        }
        .share-promo-text i {
            color: var(--accent);
            margin: 0 2px;
        }
        .share-logo-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        .share-logo {
            width: 80px;
            height: 80px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .share-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .share-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .share-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 10px;
            background: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .share-option:hover {
            background: var(--primary-light);
            transform: translateY(-5px);
        }
        .share-icon {
            font-size: 2rem;
        }
        .share-name {
            font-size: 0.9rem;
            text-align: center;
        }
        .share-link {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .share-input {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--light);
            color: var(--text);
        }
        .copy-btn {
            padding: 10px 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .qr-section {
            margin-top: 20px;
            text-align: center;
        }
        .qr-code {
            margin: 0 auto;
            padding: 10px;
            background: white;
            border-radius: 10px;
            display: inline-block;
        }
        .qr-code canvas {
            display: block;
        }
        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            border-top: 1px solid var(--border);
            color: var(--text-light);
        }
        .custom-subject-input {
            margin-top: 10px;
        }
        .progress-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .progress-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .progress-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }
        .progress-modal.active .progress-content {
            transform: translateY(0);
        }
        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        .progress-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }
        .close-progress {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .flashcards-container {
            margin-top: 20px;
        }
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 300px;
            perspective: 1000px;
            font-family: sans-serif;
            margin-bottom: 20px;
        }
        .title {
            font-size: 1.5em;
            font-weight: 900;
            text-align: center;
            margin: 0;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            box-shadow: 0 8px 14px 0 rgba(0,0,0,0.2);
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border: 1px solid var(--primary);
            border-radius: 1rem;
            padding: 20px;
        }
        .flip-card-front {
            background: linear-gradient(120deg, var(--primary-light) 60%, var(--light) 88%,
               var(--accent) 40%, rgba(255, 127, 80, 0.603) 48%);
            color: var(--primary);
        }
        .flip-card-back {
            background: linear-gradient(120deg, var(--accent) 30%, var(--primary) 88%,
               var(--primary-light) 40%, var(--light) 78%);
            color: var(--text);
            transform: rotateY(180deg);
            overflow-y: auto;
        }
        .flashcard-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .flashcard-btn {
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .flashcard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .flashcard-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .flashcard-counter {
            text-align: center;
            margin-top: 10px;
            color: var(--text-light);
        }
        .congratulations {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .congratulations.active {
            opacity: 1;
            visibility: visible;
        }
        .congratulations-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: scale(0.8);
            transition: transform 0.5s ease;
        }
        .congratulations.active .congratulations-content {
            transform: scale(1);
        }
        .congratulations-icon {
            font-size: 4rem;
            color: var(--success);
            margin-bottom: 20px;
            animation: bounce 1s infinite alternate;
        }
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-20px); }
        }
        .congratulations-title {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }
        .congratulations-message {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .three-d-card {
            transform-style: preserve-3d;
            perspective: 1000px;
            transition: transform 0.5s;
        }
        .three-d-card:hover {
            transform: rotateY(10deg) rotateX(5deg);
        }
        .scrollable-content {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        .scrollable-content::-webkit-scrollbar {
            width: 6px;
        }
        .scrollable-content::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }
        .scrollable-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }
        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .filter-toggle {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
            transition: all 0.3s ease;
        }
        .filter-toggle:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,123,255,0.4); }
        .filters {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            display: none;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .filters.active { display: block; }
        .filter-section { display: inline-block; margin-right: 30px; vertical-align: top; margin-bottom: 15px; }
        .filter-section h3 { color: var(--text); margin-bottom: 10px; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
        .filter-btn {
            padding: 8px 16px;
            margin: 4px;
            cursor: pointer;
            border: none;
            border-radius: 25px;
            background: var(--light);
            color: var(--text);
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .filter-btn.active {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 2px 10px rgba(0,123,255,0.3);
        }
        .filter-btn:hover { transform: scale(1.05); }
        .subject-filters label { display: block; margin: 5px 0; cursor: pointer; color: var(--text); }
        .subject-filters input[type="checkbox"] { margin-right: 8px; transform: scale(1.2); }
        .no-data { text-align: center; color: var(--text-light); font-style: italic; padding: 40px; }
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            .topic-form {
                grid-template-columns: 1fr;
            }
            .add-btn {
                grid-column: span 1;
            }
            .drawer {
                width: 100%;
                right: -100%;
                padding: 15px;
            }
            .drawer-menu a {
                font-size: 1rem;
                padding: 8px;
                gap: 12px;
            }
            .drawer-menu i {
                font-size: 1.1rem;
                width: 25px;
            }
            .drawer-section-title {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            .drawer-section-content {
                font-size: 0.95rem;
            }
            .go-to-menu-btn {
                padding: 12px 16px;
                font-size: 0.95rem;
                gap: 8px;
            }
            .drawer-cancel {
                padding: 12px;
                font-size: 0.95rem;
            }
            .share-options {
                grid-template-columns: repeat(2, 1fr);
            }
            .progress-content {
                padding: 20px;
            }
            .welcome-title {
                font-size: 2.2rem;
            }
            .slideshow-container {
                height: 250px;
            }
            .input-container {
                flex-direction: column;
            }
            .form-select, .form-input {
                border-radius: 0.8rem;
            }
            .add-btn {
                padding: 1rem;
                border-radius: 0.8rem;
            }
            .menu-btn {
                padding: 8px 12px;
            }
            .menu-btn span {
                font-size: 12px;
            }
            .avatar-buttons {
                flex-direction: column;
                align-items: center;
            }
            .avatar-btn {
                width: 100%;
                max-width: 250px;
            }
            .icon-grid-modal {
                grid-template-columns: repeat(4, 1fr);
            }
            .icon-option-modal {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            .filter-section { display: block; margin-bottom: 15px; }
            .timeline-header { flex-direction: column; gap: 10px; }
           
            .user-avatar-small {
                width: 45px;
                height: 45px;
            }
            .user-avatar-small i {
                font-size: 1.3rem;
            }
            .user-greeting {
                font-size: 1.3rem;
            }
        }
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .logo-text {
                font-size: 1.8rem;
            }
            .logo-icon {
                font-size: 2rem;
                width: 50px;
                height: 50px;
            }
            .welcome-content {
                padding: 20px;
            }
            .welcome-title {
                font-size: 1.8rem;
            }
            .todo-section .progress-container {
                height: 200px;
            }
            .share-options {
                grid-template-columns: repeat(2, 1fr);
            }
            .icon-grid-modal {
                grid-template-columns: repeat(3, 1fr);
            }
            .icon-option-modal {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }
            .user-avatar-small {
                width: 40px;
                height: 40px;
            }
            .user-avatar-small i {
                font-size: 1.1rem;
            }
            .user-greeting {
                font-size: 1.1rem;
            }
            .user-greeting-container {
                gap: 10px;
            }
            html, body {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            .tabs {
                gap: 8px;
            }
            .tab-btn {
                flex: 1;
                padding: 12px 8px;
                font-size: 12px;
                min-height: 44px;
            }
            .modal {
                border-radius: 20px 20px 0 0;
                max-height: 90vh;
            }
            .modal-content {
                max-height: calc(90vh - 60px);
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            .settings-modal {
                max-height: 90vh;
                border-radius: 24px 24px 0 0;
                align-items: flex-end;
                padding: 0;
            }
            .settings-content {
                max-height: 90vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                width: 100% !important;
                max-width: 100% !important;
                border-radius: 24px 24px 0 0 !important;
                border: none !important;
                box-shadow: 0 -5px 40px rgba(0, 0, 0, 0.3);
            }
            .settings-section {
                margin-bottom: 0;
                padding: 24px 20px;
            }
            .settings-section:first-of-type {
                border-radius: 24px 24px 0 0;
            }
            .theme-options {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 8px;
            }
            .theme-option {
                width: 100%;
                height: 60px;
            }
            .settings-btn {
                min-height: 48px;
                font-size: 14px;
            }
            .settings-btn-group {
                grid-template-columns: 1fr !important;
                gap: 10px;
            }
            .todo-item {
                min-height: 56px;
                padding: 12px;
            }
            .todo-checkbox {
                width: 24px;
                height: 24px;
                min-width: 24px;
                cursor: pointer;
            }
            .form-input, .form-select {
                min-height: 44px;
                font-size: 16px;
                padding: 10px;
            }
            .header {
                padding-top: max(10px, env(safe-area-inset-top));
            }
            .sidebar, .main-content {
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            #revisionProgressChart {
                max-height: 200px;
            }
            #detailedProgressChart {
                max-height: 250px;
            }
            #timelineChart {
                max-height: 200px;
            }
            .todo-item:active {
                background-color: var(--primary-light);
            }
            .theme-option:active {
                transform: scale(0.95);
            }
            .btn:active, button:active {
                opacity: 0.8;
            }
            .modal, .card {
                -webkit-user-select: none;
                user-select: none;
            }
            .modal-content, .list-container {
                will-change: transform;
                transform: translateZ(0);
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="theme-background light-theme-bg" id="themeBackground"></div>
    <div class="bg-illustration illustration-1">
        <i class="fas fa-brain"></i>
    </div>
    <div class="bg-illustration illustration-2">
        <i class="fas fa-book-open"></i>
    </div>
    <div class="bg-illustration illustration-3">
        <i class="fas fa-graduation-cap"></i>
    </div>
    <div class="bg-illustration illustration-4">
        <i class="fas fa-lightbulb"></i>
    </div>
    <div class="pattern-dots"></div>
    <div class="doodle doodle-1">
        <i class="fas fa-star"></i>
    </div>
    <div class="doodle doodle-2">
        <i class="fas fa-rocket"></i>
    </div>
    <div class="doodle doodle-3">
        <i class="fas fa-bolt"></i>
    </div>
    <div class="floating-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-content">
            <h1 class="welcome-title">RATTAFICATION</h1>
            <p class="welcome-subtitle">Master RRB/SSC/Banking exams with scientific revision scheduling</p>
            <div class="avatar-selection">
                <div class="avatar-selection-title">Choose Your Avatar</div>
                <div class="avatar-buttons">
                    <button class="avatar-btn btn-shine" id="selectIconBtn">
                        <i class="fas fa-user-astronaut"></i>
                        Select Icon
                    </button>
                    <button class="avatar-btn btn-shine" id="selectPicBtn">
                        <i class="fas fa-camera"></i>
                        Upload Picture
                    </button>
                </div>
                <div class="avatar-preview-container">
                    <div class="avatar-preview" id="avatarPreview">
                        <i class="fas fa-user" id="previewIcon"></i>
                    </div>
                    <div class="avatar-selected-text" id="avatarSelectedText">
                        Default Avatar Selected
                    </div>
                </div>
            </div>
            <div class="slideshow-container">
                <div class="slide active">
                    <div class="slide-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="slide-title">Active Recall</div>
                    <div class="slide-content">Strengthen memory pathways by testing yourself instead of just re-reading</div>
                </div>
                <div class="slide">
                    <div class="slide-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="slide-title">Spaced Repetition</div>
                    <div class="slide-content">Automated scheduling based on scientifically proven intervals</div>
                </div>
                <div class="slide">
                    <div class="slide-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="slide-title">Progress Tracking</div>
                    <div class="slide-content">Monitor your learning journey with detailed analytics</div>
                </div>
                <div class="slide">
                    <div class="slide-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="slide-title">Exam Success</div>
                    <div class="slide-content">Optimized for RRB, SSC, Banking and other competitive exams</div>
                </div>
            </div>
            <input type="text" class="name-input" id="userName" placeholder="Enter your name">
            <button class="start-btn" id="startBtn">Start Exam Preparation</button>
        </div>
    </div>
    <div class="icon-modal" id="iconModal">
        <div class="icon-modal-content">
            <div class="icon-modal-title">Select Your Avatar Icon</div>
            <div class="icon-grid-modal" id="iconGridModal"></div>
            <div class="icon-modal-actions">
                <button class="icon-modal-btn cancel" id="cancelIconSelect">Cancel</button>
                <button class="icon-modal-btn confirm" id="confirmIconSelect">Select Icon</button>
            </div>
        </div>
    </div>
    <div class="cropper-modal" id="cropperModal">
        <div class="cropper-content">
            <div class="cropper-title">Crop Your Image</div>
            <div class="cropper-zoom-controls">
                <button class="zoom-btn" id="zoomOutBtn" title="Zoom Out">
                    <i class="fas fa-minus"></i>
                </button>
                <span class="zoom-level" id="zoomLevel">100%</span>
                <button class="zoom-btn" id="zoomInBtn" title="Zoom In">
                    <i class="fas fa-plus"></i>
                </button>
                <input type="range" id="zoomSlider" class="zoom-slider" min="50" max="300" value="100">
            </div>
            <div class="cropper-container" id="cropperContainer">
                <img id="cropperImage" class="cropper-image">
                <div class="cropper-circle"></div>
                <div class="crop-instructions"> Drag image to adjust face position</div>
            </div>
            <div class="cropper-controls">
                <button class="cropper-btn cancel" id="cancelCrop">Cancel</button>
                <button class="cropper-btn confirm" id="confirmCrop">Confirm Crop</button>
            </div>
        </div>
    </div>
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <button class="close-settings" id="closeSettings">
                <i class="fas fa-times"></i>
            </button>
            <div class="settings-title">
                <i class="fas fa-cog"></i>
                Settings
            </div>
            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-palette"></i>
                    Theme Settings
                </div>
                <div class="theme-options">
                    <div class="theme-option theme-light active" data-theme="light">Light</div>
                    <div class="theme-option theme-dark" data-theme="dark">Dark</div>
                    <div class="theme-option theme-semi-dark" data-theme="semi-dark">Semi Dark</div>
                    <div class="theme-option theme-colorful" data-theme="colorful">Colorful</div>
                    <div class="theme-option theme-ocean" data-theme="ocean">Ocean</div>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-bell"></i>
                    Daily Reminders
                </div>
                <div class="notification-info">
                    <p>Get automatic reminders to revise your topics at the scheduled time, even when the app is closed.</p>
                </div>
                <div class="time-setting">
                    <label class="time-label">
                        <i class="fas fa-clock"></i>
                        Reminder Time:
                    </label>
                    <input type="time" class="time-input" id="notificationTime" value="09:00">
                </div>
                <div class="notification-features">
                    <div class="feature-item">
                        <i class="fas fa-check-circle"></i>
                        <span>System notifications</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Works in background</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-check-circle"></i>
                        <span>Repeats daily</span>
                    </div>
                </div>
                <button class="settings-btn" id="saveNotificationTime">
                    <i class="fas fa-save"></i>
                    Enable Reminders
                </button>
            </div>
            <div class="settings-section">
                <div class="settings-title">
                    <i class="fas fa-user"></i>
                    User Settings
                </div>
                <div class="user-settings">
                    <div class="user-avatar-settings" id="settingsAvatarPreview">
                        <i class="fas fa-user"></i>
                    </div>
                    <input type="text" class="user-name-input" id="settingsUserName" placeholder="Your Name">
                </div>
                <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 8px;">
                    <button class="avatar-btn" id="changeAvatarBtn" style="width: 100%; padding: 10px;">
                        <i class="fas fa-user-edit"></i>
                        Change Avatar
                    </button>
                    <button class="avatar-btn" id="uploadPicSettingsBtn" style="width: 100%; padding: 8px; font-size: 0.9rem;">
                        <i class="fas fa-camera"></i>
                        Upload Image
                    </button>
                </div>
                <button class="settings-btn" id="saveUserSettings">Save User Settings</button>
            </div>
            <div class="settings-section danger-zone">
                <div class="settings-title danger-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Danger Zone
                </div>
                <p class="danger-warning"> This action will permanently delete all your data including all topics, revisions, and settings. This cannot be undone.</p>
                <button class="settings-btn reset-btn" id="resetAppBtn">
                    <i class="fas fa-redo"></i>
                    Reset App & Delete All Data
                </button>
            </div>
        </div>
    </div>
    <div class="reset-confirm-modal" id="resetConfirmModal">
        <div class="reset-confirm-content">
            <div class="reset-confirm-header">
                <i class="fas fa-exclamation-circle"></i>
                Are you sure?
            </div>
            <p class="reset-confirm-message">
                This will <strong>permanently delete ALL data</strong> including:
                <ul>
                    <li>All topics and chapters</li>
                    <li>All revision schedules</li>
                    <li>Your avatar and settings</li>
                    <li>All app data</li>
                </ul>
            </p>
            <p class="reset-confirm-instruction">
                Type <strong>RESET</strong> below to confirm:
            </p>
            <input type="text" class="reset-confirm-input" id="resetConfirmInput" placeholder="Type RESET to confirm" maxlength="5">
            <div class="reset-confirm-actions">
                <button class="reset-confirm-btn cancel" id="cancelReset">Cancel</button>
                <button class="reset-confirm-btn confirm" id="confirmReset" disabled>Reset Everything</button>
            </div>
        </div>
    </div>
    <div class="date-topics-modal" id="dateTopicsModal">
        <div class="date-topics-content">
            <button class="close-date-topics" id="closeDateTopics">
                <i class="fas fa-times"></i>
            </button>
            <div class="date-topics-header">
                <i class="fas fa-calendar"></i>
                <span id="selectedDateDisplay"></span>
            </div>
            <div class="date-topics-list" id="dateTopicsList"></div>
        </div>
    </div>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon" id="logoIcon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div>
                    <div class="logo-text">RATTAFICATION</div>
                </div>
            </div>
            <button class="menu-btn btn-shine" id="menuBtn">
                <span>Menu</span>
            </button>
        </header>
        <div class="user-greeting-container">
            <div class="user-avatar-small" id="userAvatarSmall">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-greeting" id="userGreeting">
                Welcome back, <span id="displayName">User</span>! Ready for today's revision?
            </div>
        </div>
        <div class="dashboard">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-tasks"></i>
                    Today's Revisions
                </div>
                <div class="scrollable-content" id="todayRevisions">
                    <p>No revisions scheduled for today.</p>
                </div>
            </div>
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Progress Overview
                </div>
                <div class="progress-container">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
        </div>
        <div class="calendar-container">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-calendar-alt"></i>
                    Revision Calendar
                </div>
                <div class="calendar-header">
                    <h3 id="currentMonth">June 2023</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                        <button id="nextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar" id="calendar"></div>
            </div>
        </div>
        <div class="add-topic-section">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-plus-circle"></i>
                    Add Topic for Revision
                </div>
                <div class="topic-form">
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <div class="input-container">
                            <select class="form-select" id="subjectSelect">
                                <option value="">Select a subject</option>
                                <option value="math">Quantitative Aptitude</option>
                                <option value="reasoning">Reasoning Ability</option>
                                <option value="english">English Language</option>
                                <option value="gk">General Knowledge</option>
                                <option value="computer">Computer Knowledge</option>
                                <option value="banking">Banking Awareness</option>
                                <option value="custom">Custom Subject</option>
                            </select>
                        </div>
                        <div class="custom-subject-input" id="customSubjectGroup" style="display: none;">
                            <div class="input-container">
                                <input type="text" class="form-input" id="customSubject" placeholder="Enter custom subject name">
                            </div>
                        </div>
                    </div>
                    <div class="form-group" id="chapterGroup">
                        <label class="form-label">Chapter/Topic</label>
                        <div class="input-container">
                            <select class="form-select" id="chapterSelect">
                                <option value="">Select a chapter</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="customTopicGroup" style="display: none;">
                        <label class="form-label">Custom Topic</label>
                        <div class="input-container">
                            <input type="text" class="form-input" id="customTopic" placeholder="Enter topic name">
                        </div>
                    </div>
                    <button class="add-btn btn-shine" id="addTopicBtn">
                        <span>Add to Revision Schedule</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="todo-section">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-list-check"></i>
                    Revision To-Do List
                </div>
                <div class="scrollable-content" id="todoList">
                    <p>No revisions scheduled. Add topics to get started.</p>
                </div>
            </div>
        </div>
        <div class="backlog-section hidden" id="backlogSection">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    Backlog - Missed Revisions
                </div>
                <div class="scrollable-content" id="backlogList">
                    <p>No missed revisions. Great job!</p>
                </div>
            </div>
        </div>
        <div class="todo-section">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    Revision Progress Timeline
                </div>
                <div class="timeline-header">
                    <div></div>
                    <button class="filter-toggle" id="timelineFilterToggle">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                </div>
                <div class="filters" id="timelineFilters">
                    <div class="filter-section">
                        <h3><i class="fas fa-calendar-alt"></i> Days Filter</h3>
                        <button class="filter-btn active" data-days="7">7 Days</button>
                        <button class="filter-btn" data-days="15">15 Days</button>
                        <button class="filter-btn" data-days="30">30 Days</button>
                    </div>
                    <div class="filter-section">
                        <h3><i class="fas fa-book"></i> Subject Filter</h3>
                        <div class="subject-filters" id="subjectFilters"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>
        <div class="tips-section">
            <div class="card three-d-card">
                <div class="card-title">
                    <i class="fas fa-lightbulb"></i>
                    Exam Preparation Tips (Flashcards)
                </div>
                <div class="flashcards-container">
                    <div class="flip-card" id="flashcard">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                <p class="title" id="flashcardTitle">Active Recall</p>
                                <p>Click to flip the card</p>
                            </div>
                            <div class="flip-card-back">
                                <p class="title" id="flashcardBackTitle">Active Recall</p>
                                <p id="flashcardContent">Regularly test yourself instead of just re-reading. This strengthens memory pathways and improves retention.</p>
                            </div>
                        </div>
                    </div>
                    <div class="flashcard-nav">
                        <button class="flashcard-btn btn-shine" id="prevFlashcard">
                            <span>Previous</span>
                        </button>
                        <button class="flashcard-btn btn-shine" id="nextFlashcard">
                            <span>Next</span>
                        </button>
                    </div>
                    <div class="flashcard-counter" id="flashcardCounter">1/15</div>
                </div>
            </div>
        </div>
        <footer>
            <p>RATTAFICATION - Scientific Revision Scheduling for RRB/SSC/Banking Exams</p>
        </footer>
    </div>
    <div class="drawer" id="drawer">
        <div class="drawer-doodle drawer-doodle-1">
            <i class="fas fa-book"></i>
        </div>
        <div class="drawer-doodle drawer-doodle-2">
            <i class="fas fa-pen"></i>
        </div>
        <div class="drawer-doodle drawer-doodle-3">
            <i class="fas fa-graduation-cap"></i>
        </div>
        <div class="drawer-header">
            <div class="drawer-title">Menu</div>
        </div>
        <ul class="drawer-menu">
            <li><a href="#" id="dashboardLink"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="#" id="progressLink"><i class="fas fa-chart-bar"></i> Progress</a></li>
            <li><a href="#" id="settingsLink"><i class="fas fa-cog"></i> Settings</a></li>
            <li><a href="#" id="shareAppLink"><i class="fas fa-share-alt"></i> Share App</a></li>
            <li><a href="#" id="aboutLink"><i class="fas fa-info-circle"></i> About</a></li>
            <li><a href="#" id="doubtsLink"><i class="fas fa-question-circle"></i> Any Doubts</a></li>
        </ul>
        <div class="drawer-section" id="aboutSection" style="display: none;">
            <div class="drawer-section-title">About RATTAFICATION</div>
            <div class="drawer-section-content">
                <p>RATTAFICATION is a scientifically designed exam preparation app that helps students master competitive exams like RRB, SSC, and Banking through optimized revision scheduling.</p>
                <p>Using principles of spaced repetition and active recall, the app schedules revisions at scientifically proven intervals to maximize retention and minimize forgetting.</p>
                <button class="go-to-menu-btn" id="goToMenuFromAbout">
                    <i class="fas fa-arrow-left"></i>
                    Go to Menu
                </button>
            </div>
        </div>
        <div class="drawer-section" id="doubtsSection" style="display: none;">
            <div class="drawer-section-title">Any Doubts?</div>
            <div class="drawer-section-content">
                <p>If you have any questions or need help with the app, feel free to contact us:</p>
                <a href="https://t.me/shailuk7" class="contact-link" target="_blank">
                    <i class="fas fa-envelope"></i>
                    Contact with Support
                </a>
                <button class="go-to-menu-btn" id="goToMenuFromDoubts">
                    <i class="fas fa-arrow-left"></i>
                    Go to Menu
                </button>
            </div>
        </div>
        <div class="drawer-cancel" id="drawerCancel">Cancel</div>
    </div>
    <div class="notification-modal" id="notificationModal">
        <div class="notification-content">
            <div class="notification-title">Revision Reminder</div>
            <div class="notification-message" id="notificationMessage">
                You have revisions scheduled for today. Check your dashboard to see what needs to be reviewed.
            </div>
            <div class="notification-actions">
                <button class="notification-btn secondary" id="notificationLater">Later</button>
                <button class="notification-btn primary" id="notificationGo">Go to Revisions</button>
            </div>
        </div>
    </div>
    <div class="share-modal" id="shareModal">
        <div class="share-content">
            <div class="share-title">Share RATTAFICATION</div>
            <div class="share-promo">
                <div class="share-promo-title"> Supercharge Your Exam Preparation! </div>
                <div class="share-promo-text">
                    <i class="fas fa-rocket"></i> <strong>RATTAFICATION</strong> is the ultimate exam prep app that uses <i>scientific spaced repetition</i> to help you master RRB/SSC/Banking exams!<br><br>
                    <i class="fas fa-brain"></i> Features:<br>
                     Smart revision scheduling<br>
                     Progress tracking & analytics<br>
                     Interactive flashcards<br>
                     Backlog management<br>
                     Multiple themes<br><br>
                    <i class="fas fa-download"></i> Download now and ace your exams!
                </div>
            </div>
            <div class="share-logo-container">
                <div class="share-logo">
                    <img src="https://image2url.com/images/1764554818460-19e359ab-8fba-416d-b135-b4295f0cfbfb.png" alt="RATTAFICATION Logo" onerror="this.onerror=null; this.parentElement.innerHTML='<i class=\'fas fa-graduation-cap\' style=\'font-size:3rem;color:#4361ee\'></i>';">
                </div>
            </div>
            <div class="share-options">
                <div class="share-option" data-platform="whatsapp">
                    <div class="share-icon" style="color: #25D366;">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="share-name">WhatsApp</div>
                </div>
                <div class="share-option" data-platform="telegram">
                    <div class="share-icon" style="color: #0088cc;">
                        <i class="fab fa-telegram"></i>
                    </div>
                    <div class="share-name">Telegram</div>
                </div>
                <div class="share-option" data-platform="facebook">
                    <div class="share-icon" style="color: #1877F2;">
                        <i class="fab fa-facebook"></i>
                    </div>
                    <div class="share-name">Facebook</div>
                </div>
                <div class="share-option" data-platform="twitter">
                    <div class="share-icon" style="color: #1DA1F2;">
                        <i class="fab fa-twitter"></i>
                    </div>
                    <div class="share-name">Twitter</div>
                </div>
            </div>
            <div class="share-link">
                <input type="text" class="share-input" id="shareInput" value="https://skpro7.github.io/rattafication/" readonly>
                <button class="copy-btn" id="copyLinkBtn">Copy</button>
            </div>
            <div class="qr-section">
                <div class="share-title">QR Code</div>
                <div class="qr-code" id="qrCode"></div>
            </div>
            <div class="notification-actions" style="margin-top: 20px;">
                <button class="notification-btn secondary" id="closeShareModal">Close</button>
            </div>
        </div>
    </div>
    <div class="progress-modal" id="progressModal">
        <div class="progress-content">
            <div class="progress-header">
                <div class="progress-title">Detailed Progress Report</div>
                <button class="close-progress" id="closeProgress">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="progress-container">
                <canvas id="detailedProgressChart"></canvas>
            </div>
            <div class="card" style="margin-top: 20px;">
                <div class="card-title">
                    <i class="fas fa-list"></i>
                    Topic Completion History (Last 30 Days)
                </div>
                <div class="scrollable-content" id="progressHistory"></div>
            </div>
        </div>
    </div>
    <div class="congratulations" id="congratulations">
        <div class="congratulations-content">
            <div class="congratulations-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <div class="congratulations-title">Congratulations!</div>
            <div class="congratulations-message" id="congratulationsMessage">
                Great job completing your revision! Keep up the good work.
            </div>
            <button class="notification-btn primary" id="closeCongratulations">Continue</button>
        </div>
    </div>
    <script>
        (function() {
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            const isMobile = isAndroid || isIOS;
            
            window.deviceInfo = { isAndroid, isIOS, isMobile };
            
            if (isAndroid) {
                document.addEventListener('touchmove', (e) => {
                    if (e.touches.length > 1) e.preventDefault();
                }, { passive: false });
            }
            
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            window.addEventListener('orientationchange', setViewportHeight);
            
            let scrollTimeout;
            document.addEventListener('scroll', () => {
                document.documentElement.classList.add('is-scrolling');
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    document.documentElement.classList.remove('is-scrolling');
                }, 150);
            }, { passive: true });
            
            document.addEventListener('contextmenu', (e) => {
                if (!e.target.closest('input') && !e.target.closest('textarea')) {
                    e.preventDefault();
                }
            });
            
            const originalViewportHeight = window.innerHeight;
            window.addEventListener('resize', () => {
                const currentHeight = window.innerHeight;
                if (currentHeight < originalViewportHeight * 0.75) {
                    document.documentElement.classList.add('keyboard-active');
                } else {
                    document.documentElement.classList.remove('keyboard-active');
                }
            });
            
            let lastTouchEnd = 0;
            document.addEventListener('touchend', (e) => {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) e.preventDefault();
                lastTouchEnd = now;
            }, false);
            
            if (isIOS) {
                document.addEventListener('touchmove', (e) => {
                    if (e.target.closest('.modal-content') || 
                        e.target.closest('.list-container') ||
                        e.target.closest('.settings-content')) return;
                }, { passive: true });
            }
        })();
        
        const welcomeScreen = document.getElementById('welcomeScreen');
        const appContent = document.getElementById('appContent');
        const userNameInput = document.getElementById('userName');
        const startBtn = document.getElementById('startBtn');
        const displayName = document.getElementById('displayName');
        const menuBtn = document.getElementById('menuBtn');
        const drawer = document.getElementById('drawer');
        const drawerCancel = document.getElementById('drawerCancel');
        const dashboardLink = document.getElementById('dashboardLink');
        const subjectSelect = document.getElementById('subjectSelect');
        const chapterSelect = document.getElementById('chapterSelect');
        const customTopicGroup = document.getElementById('customTopicGroup');
        const chapterGroup = document.getElementById('chapterGroup');
        const customSubjectGroup = document.getElementById('customSubjectGroup');
        const customSubjectInput = document.getElementById('customSubject');
        const addTopicBtn = document.getElementById('addTopicBtn');
        const calendar = document.getElementById('calendar');
        const currentMonth = document.getElementById('currentMonth');
        const prevMonthBtn = document.getElementById('prevMonth');
        const nextMonthBtn = document.getElementById('nextMonth');
        const dateTopicsModal = document.getElementById('dateTopicsModal');
        const dateTopicsList = document.getElementById('dateTopicsList');
        const selectedDateDisplay = document.getElementById('selectedDateDisplay');
        const closeDateTopics = document.getElementById('closeDateTopics');
        const todayRevisions = document.getElementById('todayRevisions');
        const todoList = document.getElementById('todoList');
        const backlogSection = document.getElementById('backlogSection');
        const backlogList = document.getElementById('backlogList');
        const aboutLink = document.getElementById('aboutLink');
        const doubtsLink = document.getElementById('doubtsLink');
        const settingsLink = document.getElementById('settingsLink');
        const progressLink = document.getElementById('progressLink');
        const aboutSection = document.getElementById('aboutSection');
        const doubtsSection = document.getElementById('doubtsSection');
        const goToMenuFromAbout = document.getElementById('goToMenuFromAbout');
        const goToMenuFromDoubts = document.getElementById('goToMenuFromDoubts');
        const shareAppLink = document.getElementById('shareAppLink');
        const notificationModal = document.getElementById('notificationModal');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationLater = document.getElementById('notificationLater');
        const notificationGo = document.getElementById('notificationGo');
        const shareModal = document.getElementById('shareModal');
        const shareInput = document.getElementById('shareInput');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const closeShareModal = document.getElementById('closeShareModal');
        const progressModal = document.getElementById('progressModal');
        const closeProgress = document.getElementById('closeProgress');
        const detailedProgressChart = document.getElementById('detailedProgressChart');
        const progressHistory = document.getElementById('progressHistory');
        const flashcard = document.getElementById('flashcard');
        const flashcardTitle = document.getElementById('flashcardTitle');
        const flashcardBackTitle = document.getElementById('flashcardBackTitle');
        const flashcardContent = document.getElementById('flashcardContent');
        const prevFlashcard = document.getElementById('prevFlashcard');
        const nextFlashcard = document.getElementById('nextFlashcard');
        const flashcardCounter = document.getElementById('flashcardCounter');
        const congratulations = document.getElementById('congratulations');
        const congratulationsMessage = document.getElementById('congratulationsMessage');
        const closeCongratulations = document.getElementById('closeCongratulations');
        const slides = document.querySelectorAll('.slide');
        const themeBackground = document.getElementById('themeBackground');
        const qrCode = document.getElementById('qrCode');
        const cropperModal = document.getElementById('cropperModal');
        const cropperImage = document.getElementById('cropperImage');
        const cropperContainer = document.getElementById('cropperContainer');
        const zoomInBtn = document.getElementById('zoomInBtn');
        const zoomOutBtn = document.getElementById('zoomOutBtn');
        const zoomSlider = document.getElementById('zoomSlider');
        const zoomLevel = document.getElementById('zoomLevel');
        const cancelCrop = document.getElementById('cancelCrop');
        const confirmCrop = document.getElementById('confirmCrop');
        const logoIcon = document.getElementById('logoIcon');
        const userAvatarSmall = document.getElementById('userAvatarSmall');
        const avatarPreview = document.getElementById('avatarPreview');
        const previewIcon = document.getElementById('previewIcon');
        const avatarSelectedText = document.getElementById('avatarSelectedText');
        const selectIconBtn = document.getElementById('selectIconBtn');
        const selectPicBtn = document.getElementById('selectPicBtn');
        const iconModal = document.getElementById('iconModal');
        const iconGridModal = document.getElementById('iconGridModal');
        const cancelIconSelect = document.getElementById('cancelIconSelect');
        const confirmIconSelect = document.getElementById('confirmIconSelect');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettings = document.getElementById('closeSettings');
        const settingsAvatarPreview = document.getElementById('settingsAvatarPreview');
        const settingsUserName = document.getElementById('settingsUserName');
        const notificationTime = document.getElementById('notificationTime');
        const saveNotificationTime = document.getElementById('saveNotificationTime');
        const changeAvatarBtn = document.getElementById('changeAvatarBtn');
        const uploadPicSettingsBtn = document.getElementById('uploadPicSettingsBtn');
        const saveUserSettings = document.getElementById('saveUserSettings');
        const resetAppBtn = document.getElementById('resetAppBtn');
        const resetConfirmModal = document.getElementById('resetConfirmModal');
        const resetConfirmInput = document.getElementById('resetConfirmInput');
        const cancelReset = document.getElementById('cancelReset');
        const confirmReset = document.getElementById('confirmReset');
        const timelineFilterToggle = document.getElementById('timelineFilterToggle');
        const timelineFilters = document.getElementById('timelineFilters');
        const subjectFilters = document.getElementById('subjectFilters');

        let currentUser = '';
        let currentDate = new Date();
        let topics = JSON.parse(localStorage.getItem('topics')) || [];
        let currentTheme = localStorage.getItem('currentTheme') || 'light';
        let currentFlashcardIndex = 0;
        let currentSlideIndex = 0;
        let selectedIcon = 'fas fa-user';
        let currentImageForCropping = null;
        let currentZoomLevel = 100;
        let imageOffsetX = 0;
        let imageOffsetY = 0;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let selectedIconInModal = 'fas fa-user';
        let notificationTimeValue = localStorage.getItem('notificationTime') || '09:00';

        const subjects = {
            math: {
                name: 'Math',
                icon: 'fas fa-calculator',
                color: '#4cc9f0',
                chapters: [
                    'Number System', 'Decimals', 'Fractions', 'LCM, HCF', 'Ratio and Proportions',
                    'Percentage', 'Mensuration', 'Time and Work', 'Time and Distance',
                    'Simple and Compound Interest', 'Profit and Loss', 'Elementary Algebra',
                    'Geometry and Trigonometry', 'Elementary Statistics', 'Custom Topic'
                ]
            },
            reasoning: {
                name: 'Reas.',
                icon: 'fas fa-puzzle-piece',
                color: '#f72585',
                chapters: [
                    'Analogies', 'Completion of Number and Alphabetical Series', 'Coding and Decoding',
                    'Mathematical Operations', 'Similarities and Differences', 'Relationships',
                    'Analytical Reasoning', 'Syllogism', 'Jumbling', 'Venn Diagrams', 'Puzzle',
                    'Data Sufficiency', 'Statement- Conclusion', 'Statement- Courses of Action',
                    'Decision Making', 'Maps', 'Interpretation of Graphs', 'Custom Topic'
                ]
            },
            english: {
                name: 'Eng',
                icon: 'fas fa-language',
                color: '#4895ef',
                chapters: [
                    'Reading Comprehension', 'Cloze Test', 'Error Spotting', 'Sentence Improvement',
                    'Fill in the Blanks', 'Para Jumbles', 'Vocabulary', 'Grammar', 'Idioms & Phrases',
                    'One Word Substitution', 'Active & Passive Voice', 'Direct & Indirect Speech',
                    'Spelling Check', 'Custom Topic'
                ]
            },
            gk: {
                name: 'GA',
                icon: 'fas fa-globe',
                color: '#7209b7',
                chapters: [
                    'Current Events of National and International Importance', 'Games and Sports',
                    'Art and Culture of India', 'Indian Literature', 'Monuments and Places of India',
                    'General Science and Life Science', 'History of India and Freedom Struggle',
                    'Physical, Social and Economic Geography of India and the World',
                    'Indian Polity and Governance', 'General Scientific and Technological Developments',
                    'UN and Other Important World Organizations', 'Environmental Issues',
                    'Basics of Computers and Computer Applications', 'Common Abbreviations',
                    'Transport Systems in India', 'Indian Economy', 'Famous Personalities',
                    'Flagship Government Programs', 'Flora and Fauna of India',
                    'Important Government and Public Sector Organisations', 'Current GK', 'Custom Topic'
                ]
            },
            computer: {
                name: 'Comp.',
                icon: 'fas fa-laptop-code',
                color: '#3a0ca3',
                chapters: [
                    'Computer Fundamentals', 'Hardware & Software', 'Operating System', 'MS Office',
                    'Internet & Networking', 'Database Management', 'Computer Security', 'Programming Concepts',
                    'Computer Abbreviations', 'Input & Output Devices', 'Memory', 'Computer Languages', 'Custom Topic'
                ]
            },
            banking: {
                name: 'Bank GA',
                icon: 'fas fa-university',
                color: '#38b000',
                chapters: [
                    'Banking History', 'RBI & Its Functions', 'Banking Terms', 'Types of Accounts',
                    'Negotiable Instruments', 'Payment Systems', 'Financial Institutions', 'Monetary Policy',
                    'Non-Performing Assets', 'KYC Guidelines', 'Banking Ombudsman', 'Recent Banking Reforms', 'Custom Topic'
                ]
            },
            custom: {
                name: 'Custom Subject',
                icon: 'fas fa-edit',
                color: '#6c757d',
                chapters: ['Custom Topic']
            }
        };

        const flashcards = [
            { title: "Active Recall", content: "Regularly test yourself instead of just re-reading. This strengthens memory pathways and improves retention." },
            { title: "Spaced Repetition", content: "Review material at increasing intervals to combat the forgetting curve. This app automates this process for you." },
            { title: "Interleaving", content: "Mix different subjects or topics during study sessions for better retention and understanding." },
            { title: "Pomodoro Technique", content: "Study in focused 25-minute intervals with 5-minute breaks. This improves concentration and prevents burnout." },
            { title: "Mind Mapping", content: "Create visual diagrams to organize information. This helps in understanding complex topics and improves memory." },
            { title: "Meditation for Focus", content: "Practice 10 minutes of meditation daily to improve focus and reduce stress." },
            { title: "Fast Revision Techniques", content: "Use mnemonics, acronyms, and visualization for quick revision before exams." },
            { title: "Long Term Memory", content: "Connect new information to what you already know. This creates stronger neural connections and improves long-term retention." },
            { title: "Effective Note Taking", content: "Use the Cornell method for note-taking: divide page into cues, notes, and summary sections for better organization." },
            { title: "Study Environment", content: "Create a dedicated study space with good lighting, minimal distractions, and all necessary materials." },
            { title: "Healthy Study Habits", content: "Get adequate sleep, exercise regularly, and maintain a balanced diet for optimal brain function." },
            { title: "Time Management", content: "Prioritize tasks using the Eisenhower Matrix: urgent/important, important/not urgent, urgent/not important, not urgent/not important." },
            { title: "Exam Strategy", content: "Read all questions first, start with easier ones, manage time wisely, and review answers if time permits." },
            { title: "Stress Management", content: "Practice deep breathing, take short breaks, and maintain a positive mindset during study sessions." },
            { title: "Revision Schedule", content: "Follow the 1-3-7-15-30 day revision pattern for optimal retention of information." }
        ];

        const iconOptions = [
            'fas fa-user-astronaut', 'fas fa-user-ninja', 'fas fa-user-secret', 'fas fa-robot',
            'fas fa-cat', 'fas fa-dog', 'fas fa-dragon', 'fas fa-hippo', 'fas fa-horse',
            'fas fa-fish', 'fas fa-kiwi-bird', 'fas fa-otter', 'fas fa-dove', 'fas fa-crow',
            'fas fa-frog', 'fas fa-ghost', 'fas fa-hat-wizard', 'fas fa-mask', 'fas fa-user-tie',
            'fas fa-user-graduate', 'fas fa-user-md', 'fas fa-user-injured', 'fas fa-user-check',
            'fas fa-user-edit', 'fas fa-user-friends', 'fas fa-user-clock', 'fas fa-user-cog',
            'fas fa-user-shield', 'fas fa-user-tag', 'fas fa-user-plus', 'fas fa-user-slash',
            'fas fa-user-alt', 'fas fa-user-circle', 'fas fa-user-tie', 'fas fa-user-nurse',
            'fas fa-rocket', 'fas fa-satellite', 'fas fa-meteor', 'fas fa-star', 'fas fa-moon',
            'fas fa-sun', 'fas fa-cloud', 'fas fa-bolt', 'fas fa-snowflake', 'fas fa-fire',
            'fas fa-seedling', 'fas fa-tree', 'fas fa-feather', 'fas fa-paw', 'fas fa-bug'
        ];

        function initApp() {
            updateLogo();
            window.addEventListener('online', updateLogo);
            window.addEventListener('offline', updateLogo);

            applyTheme(currentTheme);
            notificationTime.value = notificationTimeValue;
            initIconModal();

            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                displayName.textContent = currentUser;
                settingsUserName.value = currentUser;
                const savedIcon = localStorage.getItem('userIcon');
                if (savedIcon) {
                    selectedIcon = savedIcon;
                    applyUserIcon(savedIcon);
                }
                showApp();
            }

            startSlideshow();
            setupEventListeners();
            renderCalendar();
            initProgressChart();
            initDetailedProgressChart();
            initTimelineChart();
            initSubjectFilters();
            checkTodaysRevisions();
            renderTodoList();
            renderBacklog();
            updateFlashcard();
            checkForNotification();
            scheduleDailyNotification();
            checkAutoRemoval();
        }

        function updateLogo() {
            if (navigator.onLine) {
                const img = document.createElement('img');
                img.src = 'https://image2url.com/images/1764554818460-19e359ab-8fba-416d-b135-b4295f0cfbfb.png';
                img.onerror = () => logoIcon.innerHTML = '<i class="fas fa-graduation-cap"></i>';
                img.onload = () => {
                    logoIcon.innerHTML = '';
                    logoIcon.appendChild(img);
                };
                logoIcon.innerHTML = '';
                logoIcon.appendChild(img);
            } else {
                logoIcon.innerHTML = '<i class="fas fa-graduation-cap"></i>';
            }
        }

        function applyUserIcon(icon) {
            if (icon.startsWith('data:image')) {
                const img1 = document.createElement('img');
                img1.src = icon;
                avatarPreview.innerHTML = '';
                avatarPreview.appendChild(img1);

                const img2 = document.createElement('img');
                img2.src = icon;
                userAvatarSmall.innerHTML = '';
                userAvatarSmall.appendChild(img2);

                const img3 = document.createElement('img');
                img3.src = icon;
                settingsAvatarPreview.innerHTML = '';
                settingsAvatarPreview.appendChild(img3);

                avatarSelectedText.textContent = 'Custom Picture Selected';
            } else {
                avatarPreview.innerHTML = `<i class="${icon}"></i>`;
                userAvatarSmall.innerHTML = `<i class="${icon}"></i>`;
                settingsAvatarPreview.innerHTML = `<i class="${icon}"></i>`;
                avatarSelectedText.textContent = 'Icon Selected';
            }
        }

        function initIconModal() {
            iconGridModal.innerHTML = '';
            iconOptions.forEach(icon => {
                const iconOption = document.createElement('div');
                iconOption.className = 'icon-option-modal';
                iconOption.innerHTML = `<i class="${icon}"></i>`;
                iconOption.setAttribute('data-icon', icon);
                iconOption.setAttribute('role', 'button');
                iconOption.setAttribute('tabindex', '0');

                if (icon === selectedIcon) {
                    iconOption.classList.add('selected');
                    selectedIconInModal = icon;
                }

                const handleIconSelect = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    document.querySelectorAll('.icon-option-modal').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedIconInModal = this.getAttribute('data-icon');
                };

                iconOption.addEventListener('click', handleIconSelect, { passive: false });
                iconOption.addEventListener('touchend', handleIconSelect, { passive: false });
                iconOption.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });

                iconGridModal.appendChild(iconOption);
            });
        }

        function openIconModal() {
            if (iconGridModal.children.length === 0) initIconModal();
            setTimeout(() => iconModal.classList.add('active'), 50);
        }

        function closeIconModal() {
            iconModal.classList.remove('active');
        }

        function confirmIconSelection() {
            if (!selectedIconInModal) {
                alert('Please select an icon first');
                return;
            }
            selectedIcon = selectedIconInModal;
            applyUserIcon(selectedIcon);
            localStorage.setItem('userIcon', selectedIcon);
            if (window.deviceInfo?.isAndroid && navigator.vibrate) navigator.vibrate(50);
            closeIconModal();
        }

        function openPictureSelection() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.position = 'fixed';
            input.style.left = '0';
            input.style.top = '0';
            input.style.width = '1px';
            input.style.height = '1px';
            input.style.opacity = '0.01';
            input.style.zIndex = '2147483647';
            input.style.pointerEvents = 'auto';

            document.body.appendChild(input);
            try {
                input.click();
            } catch (err) {
                input.focus();
                setTimeout(() => input.click(), 50);
            }

            input.onchange = function(event) {
                const file = event.target.files && event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            currentImageForCropping = e.target.result;
                            currentZoomLevel = 100;
                            imageOffsetX = 0;
                            imageOffsetY = 0;
                            cropperImage.src = currentImageForCropping;
                            cropperImage.onload = function() {
                                updateZoom();
                                cropperModal.classList.add('active');
                                if (window.deviceInfo?.isAndroid) {
                                    setTimeout(() => {
                                        document.body.scrollTop = 0;
                                        document.documentElement.scrollTop = 0;
                                    }, 100);
                                }
                            };
                            setTimeout(() => {
                                if (!cropperModal.classList.contains('active')) {
                                    updateZoom();
                                    cropperModal.classList.add('active');
                                }
                            }, 500);
                        } catch (error) {
                            console.error('Error loading image:', error);
                            alert('Failed to load image. Please try again.');
                        }
                    };
                    reader.onerror = function() {
                        console.error('FileReader error');
                        alert('Error reading file. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
                setTimeout(() => {
                    if (input && input.parentNode) input.parentNode.removeChild(input);
                }, 300);
            };

            input.onerror = function() {
                console.error('File input error');
                alert('Could not open file picker. Please try again.');
                if (input && input.parentNode) input.parentNode.removeChild(input);
            };
        }

        function openPictureSelectionFromSettings() {
            closeSettingsModal();
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.position = 'fixed';
            input.style.left = '0';
            input.style.top = '0';
            input.style.width = '1px';
            input.style.height = '1px';
            input.style.opacity = '0.01';
            input.style.zIndex = '2147483647';
            input.style.pointerEvents = 'auto';

            document.body.appendChild(input);
            try {
                input.click();
            } catch (err) {
                input.focus();
                setTimeout(() => input.click(), 50);
            }

            input.onchange = function(event) {
                const file = event.target.files && event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            currentImageForCropping = e.target.result;
                            currentZoomLevel = 100;
                            imageOffsetX = 0;
                            imageOffsetY = 0;
                            cropperImage.src = currentImageForCropping;
                            cropperImage.onload = function() {
                                updateZoom();
                                setTimeout(() => {
                                    cropperModal.classList.add('active');
                                    if (window.deviceInfo?.isAndroid) {
                                        document.body.scrollTop = 0;
                                        document.documentElement.scrollTop = 0;
                                    }
                                }, 100);
                            };
                            setTimeout(() => {
                                if (!cropperModal.classList.contains('active')) {
                                    updateZoom();
                                    cropperModal.classList.add('active');
                                }
                            }, 500);
                        } catch (error) {
                            console.error('Error loading image:', error);
                            alert('Failed to load image. Please try again.');
                        }
                    };
                    reader.onerror = function() {
                        console.error('FileReader error');
                        alert('Error reading file. Please try again.');
                    };
                    reader.readAsDataURL(file);
                }
                setTimeout(() => {
                    if (input && input.parentNode) input.parentNode.removeChild(input);
                }, 300);
            };

            input.onerror = function() {
                console.error('File input error');
                alert('Could not open file picker. Please try again.');
                if (input && input.parentNode) input.parentNode.removeChild(input);
            };
        }

        function zoomIn() {
            currentZoomLevel = Math.min(currentZoomLevel + 10, 300);
            updateZoom();
        }

        function zoomOut() {
            currentZoomLevel = Math.max(currentZoomLevel - 10, 50);
            updateZoom();
        }

        function handleZoomSlider(e) {
            currentZoomLevel = parseInt(e.target.value);
            updateZoom();
        }

        function updateZoom() {
            zoomLevel.textContent = currentZoomLevel + '%';
            zoomSlider.value = currentZoomLevel;
            cropperImage.style.transform = `scale(${currentZoomLevel / 100}) translate(${imageOffsetX}px, ${imageOffsetY}px)`;
        }

        function startDrag(e) {
            isDragging = true;
            dragStartX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            dragStartY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            cropperContainer.style.cursor = 'grabbing';
        }

        function moveDrag(e) {
            if (!isDragging) return;
            e.preventDefault();
            const currentX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const currentY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            const deltaX = currentX - dragStartX;
            const deltaY = currentY - dragStartY;
            const s = currentZoomLevel / 100;
            const containerRect = cropperContainer.getBoundingClientRect();
            const naturalW = cropperImage.naturalWidth || cropperImage.width || 1;
            const naturalH = cropperImage.naturalHeight || cropperImage.height || 1;
            const fitScale = Math.min(containerRect.width / naturalW, containerRect.height / naturalH);
            const displayedW0 = naturalW * fitScale;
            const displayedH0 = naturalH * fitScale;
            const scaledW = displayedW0 * s;
            const scaledH = displayedH0 * s;
            let newOffsetX = imageOffsetX + deltaX / s;
            let newOffsetY = imageOffsetY + deltaY / s;
            const circleEl = document.querySelector('.cropper-circle');
            const circleDiameter = circleEl ? circleEl.clientWidth : Math.min(containerRect.width, containerRect.height) * 0.6;
            const maxOffsetX = Math.max(0, (scaledW - circleDiameter) / (2 * s));
            const maxOffsetY = Math.max(0, (scaledH - circleDiameter) / (2 * s));
            newOffsetX = Math.max(-maxOffsetX, Math.min(maxOffsetX, newOffsetX));
            newOffsetY = Math.max(-maxOffsetY, Math.min(maxOffsetY, newOffsetY));
            imageOffsetX = newOffsetX;
            imageOffsetY = newOffsetY;
            dragStartX = currentX;
            dragStartY = currentY;
            updateZoom();
        }

        function endDrag() {
            isDragging = false;
            cropperContainer.style.cursor = 'grab';
        }

        function cancelCropping() {
            cropperModal.classList.remove('active');
            currentImageForCropping = null;
            currentZoomLevel = 100;
            imageOffsetX = 0;
            imageOffsetY = 0;
            updateZoom();
        }

        function confirmCropping() {
            if (!currentImageForCropping) return;
            const img = new Image();
            img.onload = function() {
                const containerRect = cropperContainer.getBoundingClientRect();
                const circleEl = document.querySelector('.cropper-circle');
                const circleRect = circleEl.getBoundingClientRect();
                const containerW = containerRect.width;
                const containerH = containerRect.height;
                const circleDiameter = Math.min(circleRect.width, circleRect.height);
                const naturalW = img.naturalWidth;
                const naturalH = img.naturalHeight;
                const fitScale = Math.min(containerW / naturalW, containerH / naturalH);
                const displayedW0 = naturalW * fitScale;
                const displayedH0 = naturalH * fitScale;
                const s = currentZoomLevel / 100;
                const scaledW = displayedW0 * s;
                const scaledH = displayedH0 * s;
                const centerX = containerW / 2 + imageOffsetX * s;
                const centerY = containerH / 2 + imageOffsetY * s;
                const imgLeft = centerX - scaledW / 2;
                const imgTop = centerY - scaledH / 2;
                const circleLeft = circleRect.left - containerRect.left;
                const circleTop = circleRect.top - containerRect.top;
                let srcX_displayed = circleLeft - imgLeft;
                let srcY_displayed = circleTop - imgTop;
                let srcW_displayed = circleDiameter;
                let srcH_displayed = circleDiameter;
                const scaleX = naturalW / scaledW;
                const scaleY = naturalH / scaledH;
                let srcX = srcX_displayed * scaleX;
                let srcY = srcY_displayed * scaleY;
                let srcW = srcW_displayed * scaleX;
                let srcH = srcH_displayed * scaleY;
                if (srcX < 0) srcX = 0;
                if (srcY < 0) srcY = 0;
                if (srcX + srcW > naturalW) srcX = Math.max(0, naturalW - srcW);
                if (srcY + srcH > naturalH) srcY = Math.max(0, naturalH - srcH);
                const canvas = document.createElement('canvas');
                const size = 200;
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, size, size);
                ctx.beginPath();
                ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI * 2);
                ctx.closePath();
                ctx.clip();
                ctx.drawImage(img, srcX, srcY, srcW, srcH, 0, 0, size, size);
                const croppedImage = canvas.toDataURL('image/png');
                selectedIcon = croppedImage;
                applyUserIcon(croppedImage);
                localStorage.setItem('userIcon', croppedImage);
                cropperModal.classList.remove('active');
                currentImageForCropping = null;
                currentZoomLevel = 100;
                imageOffsetX = 0;
                imageOffsetY = 0;
            };
            img.src = currentImageForCropping;
        }

        function openAvatarChange() {
            closeSettingsModal();
            openIconModal();
            const userIcon = localStorage.getItem('userIcon');
            if (userIcon) applyUserIcon(userIcon);
        }

        function startSlideshow() {
            setInterval(() => {
                slides[currentSlideIndex].classList.remove('active');
                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                slides[currentSlideIndex].classList.add('active');
            }, 4000);
        }

        function isDarkThemeActive() {
            return document.documentElement.classList.contains('dark-theme') ||
                   document.body.classList.contains('dark-theme') ||
                   document.documentElement.classList.contains('semi-dark-theme') ||
                   document.body.classList.contains('semi-dark-theme');
        }

        function applyTheme(theme) {
            document.documentElement.className = theme + '-theme';
            document.body.className = theme + '-theme';
            currentTheme = theme;
            themeBackground.className = 'theme-background ' + theme + '-theme-bg';
            updateChartColors();
            document.querySelectorAll('.theme-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.getAttribute('data-theme') === theme) opt.classList.add('active');
            });
        }

        function updateChartColors() {
            const isDarkTheme = isDarkThemeActive();
            const textColor = isDarkTheme ? '#ffffff' : '#000000';
            const gridColor = isDarkTheme ? '#444444' : '#e0e0e0';

            if (window.progressChartInstance) {
                window.progressChartInstance.options.plugins.legend.labels.color = textColor;
                window.progressChartInstance.update();
            }

            if (window.timelineChartInstance) {
                window.timelineChartInstance.options.plugins.legend.labels.color = textColor;
                window.timelineChartInstance.options.scales.x.grid.color = gridColor;
                window.timelineChartInstance.options.scales.x.ticks.color = textColor;
                window.timelineChartInstance.options.scales.y.grid.color = gridColor;
                window.timelineChartInstance.options.scales.y.ticks.color = textColor;
                window.timelineChartInstance.update();
            }

            if (window.detailedProgressChartInstance) {
                window.detailedProgressChartInstance.options.plugins.legend.labels.color = textColor;
                window.detailedProgressChartInstance.options.scales.x.grid.color = gridColor;
                window.detailedProgressChartInstance.options.scales.x.ticks.color = textColor;
                window.detailedProgressChartInstance.options.scales.y.grid.color = gridColor;
                window.detailedProgressChartInstance.options.scales.y.ticks.color = textColor;
                window.detailedProgressChartInstance.update();
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                setTimeout(() => {
                    if (confirm(" Enable notifications to get daily revision reminders with topic names? \n\nYou'll get notified at your scheduled time even if the app is closed!")) {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                scheduleDailyNotification();
                            }
                        });
                    }
                }, 2000);
            } else if (Notification.permission === 'granted') {
                scheduleDailyNotification();
            }
        }

        function startApp() {
            const name = userNameInput.value.trim();
            if (name) {
                currentUser = name;
                localStorage.setItem('currentUser', name);
                localStorage.setItem('userIcon', selectedIcon);
                applyUserIcon(selectedIcon);
                requestNotificationPermission();
                showApp();
            } else {
                alert('Please enter your name to continue.');
            }
        }

        function showApp() {
            welcomeScreen.style.opacity = '0';
            setTimeout(() => {
                welcomeScreen.style.display = 'none';
                appContent.style.display = 'block';
                displayName.textContent = currentUser;
                settingsUserName.value = currentUser;
                if ('Notification' in window && Notification.permission === 'granted') {
                    scheduleDailyNotification();
                }
            }, 800);
        }

        function toggleDrawer() {
            drawer.classList.toggle('open');
        }

        function closeDrawerAndGoToDashboard(e) {
            e.preventDefault();
            toggleDrawer();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function showAbout(e) {
            if (e && e.preventDefault) e.preventDefault();
            aboutSection.style.display = 'block';
            doubtsSection.style.display = 'none';
            drawer.classList.add('open');
        }

        function showDoubts(e) {
            if (e && e.preventDefault) e.preventDefault();
            aboutSection.style.display = 'none';
            doubtsSection.style.display = 'block';
            drawer.classList.add('open');
        }

        function goBackToMenu(e) {
            if (e && e.preventDefault) e.preventDefault();
            if (e && e.stopPropagation) e.stopPropagation();
            aboutSection.style.display = 'none';
            doubtsSection.style.display = 'none';
            drawer.classList.add('open');
        }

        function showSettings(e) {
            e.preventDefault();
            settingsModal.classList.add('active');
            document.body.classList.add('settings-open');
            toggleDrawer();
        }

        function closeSettingsModal() {
            settingsModal.classList.remove('active');
            document.body.classList.remove('settings-open');
        }

        function openResetConfirmModal() {
            closeSettingsModal();
            resetConfirmInput.value = '';
            confirmReset.disabled = true;
            resetConfirmModal.classList.add('active');
        }

        function closeResetConfirmModal() {
            resetConfirmModal.classList.remove('active');
            resetConfirmInput.value = '';
            confirmReset.disabled = true;
        }

        function validateResetInput() {
            const inputValue = resetConfirmInput.value.toUpperCase();
            confirmReset.disabled = inputValue !== 'RESET';
        }

        function performAppReset() {
            try {
                localStorage.clear();
                sessionStorage.clear();
                if (window.deviceInfo?.isAndroid && navigator.vibrate) navigator.vibrate([100, 50, 100]);
                alert(' App reset complete! Restarting...');
                setTimeout(() => window.location.reload(), 500);
            } catch (error) {
                console.error('Error during reset:', error);
                alert('Error during reset. Please try again.');
                closeResetConfirmModal();
            }
        }

        function saveNotificationTimeFunc() {
            notificationTimeValue = notificationTime.value;
            localStorage.setItem('notificationTime', notificationTimeValue);
            alert(' Notification time saved! Reminders will come at ' + notificationTimeValue);
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('firebase-messaging-sw.js').then(reg => {
                    console.log('Service Worker registered for push:', reg);
                }).catch(err => {
                    console.warn('Service Worker registration failed:', err);
                });
            }
            if ('Notification' in window && Notification.permission !== 'granted') {
                Notification.requestPermission().then(permission => {
                    console.log('Notification permission:', permission);
                });
            }
            scheduleDailyNotification();
        }

        function saveUserSettingsFunc() {
            const newName = settingsUserName.value.trim();
            if (newName) {
                currentUser = newName;
                localStorage.setItem('currentUser', newName);
                displayName.textContent = newName;
                localStorage.setItem('userIcon', selectedIcon);
                alert('User settings saved! ');
            } else {
                alert('Please enter a valid name.');
            }
        }

        function showProgressModal(e) {
            e.preventDefault();
            progressModal.classList.add('active');
            initDetailedProgressChart();
            renderProgressHistory();
            toggleDrawer();
        }

        function closeProgressModal() {
            progressModal.classList.remove('active');
        }

        function showShareModal(e) {
            e.preventDefault();
            shareModal.classList.add('active');
            toggleDrawer();
            generateQRCode();
        }

        function generateQRCode() {
            const shareUrl = shareInput.value;
            qrCode.innerHTML = '';
            if (navigator.onLine && typeof QRCode !== 'undefined') {
                QRCode.toCanvas(qrCode, shareUrl, {
                    width: 150,
                    height: 150,
                    colorDark: '#000000',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.H
                }, function(error) {
                    if (error) {
                        qrCode.innerHTML = '<p>QR Code unavailable offline. Copy link above.</p>';
                    }
                });
            } else {
                qrCode.innerHTML = '<p>QR Code unavailable offline. Copy link above.</p>';
            }
        }

        function closeShareModalFunc() {
            shareModal.classList.remove('active');
        }

        function copyShareLink() {
            shareInput.select();
            document.execCommand('copy');
            alert(' Link copied to clipboard!');
        }

        function shareOnPlatform(platform) {
            const url = encodeURIComponent('https://skpro7.github.io/rattafication/');
            const text = encodeURIComponent(' Supercharge Your Exam Preparation with RATTAFICATION! \n\n Master RRB/SSC/Banking exams using scientific spaced repetition\n Smart revision scheduling\n Progress tracking & analytics\n Multiple beautiful themes\n\nDownload now: https://skpro7.github.io/rattafication/\n\n#ExamPrep #StudySmart #RATTAFICATION #Success');
            let shareUrl = '';
            switch(platform) {
                case 'whatsapp': shareUrl = `https://wa.me/?text=${text}`; break;
                case 'telegram': shareUrl = `https://t.me/share/url?url=${url}&text=${text}`; break;
                case 'facebook': shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`; break;
                case 'twitter': shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`; break;
            }
            if (shareUrl) window.open(shareUrl, '_blank');
        }

        function handleSubjectChange() {
            const selectedSubject = subjectSelect.value;
            chapterSelect.innerHTML = '<option value="">Select a chapter</option>';
            if (selectedSubject && subjects[selectedSubject]) {
                subjects[selectedSubject].chapters.forEach(chapter => {
                    const option = document.createElement('option');
                    option.value = chapter;
                    option.textContent = chapter;
                    chapterSelect.appendChild(option);
                });
            }
            if (selectedSubject === 'custom') {
                customSubjectGroup.style.display = 'block';
                chapterGroup.style.display = 'none';
                customTopicGroup.style.display = 'block';
            } else {
                customSubjectGroup.style.display = 'none';
                chapterGroup.style.display = 'block';
                customTopicGroup.style.display = 'none';
            }
        }

        function handleChapterChange() {
            const selectedChapter = chapterSelect.value;
            if (selectedChapter === 'Custom Topic') {
                customTopicGroup.style.display = 'block';
            } else {
                customTopicGroup.style.display = 'none';
            }
        }

        function addTopic() {
            const subject = subjectSelect.value;
            let subjectName, topicName;
            if (!subject) {
                alert('Please select a subject.');
                return;
            }
            if (subject === 'custom') {
                subjectName = customSubjectInput.value.trim();
                topicName = document.getElementById('customTopic').value.trim();
                if (!subjectName) {
                    alert('Please enter a custom subject name.');
                    return;
                }
                if (!topicName) {
                    alert('Please enter a topic name.');
                    return;
                }
            } else {
                subjectName = subjects[subject].name;
                topicName = chapterSelect.value;
                if (!topicName) {
                    alert('Please select a chapter.');
                    return;
                }
                if (topicName === 'Custom Topic') {
                    const customTopic = document.getElementById('customTopic').value.trim();
                    if (!customTopic) {
                        alert('Please enter a topic name.');
                        return;
                    }
                    topicName = customTopic;
                }
            }
            const today = new Date();
            const revisionDates = [
                new Date(today),
                new Date(today.getTime() + 2 * 24 * 60 * 60 * 1000),
                new Date(today.getTime() + 6 * 24 * 60 * 60 * 1000),
                new Date(today.getTime() + 14 * 24 * 60 * 60 * 1000),
                new Date(today.getTime() + 29 * 24 * 60 * 60 * 1000)
            ];
            const newTopic = {
                id: Date.now(),
                subject: subject,
                subjectName: subjectName,
                topicName: topicName,
                addedDate: today,
                revisionDates: revisionDates,
                completedRevisions: [false, false, false, false, false],
                lastCompletionDate: null
            };
            topics.push(newTopic);
            localStorage.setItem('topics', JSON.stringify(topics));
            subjectSelect.value = '';
            chapterSelect.value = '';
            customSubjectInput.value = '';
            document.getElementById('customTopic').value = '';
            customSubjectGroup.style.display = 'none';
            customTopicGroup.style.display = 'none';
            chapterGroup.style.display = 'block';
            renderCalendar();
            checkTodaysRevisions();
            initProgressChart();
            updateTimelineChart();
            initSubjectFilters();
            renderTodoList();
            renderBacklog();
            alert(' Topic added to revision schedule successfully!');
        }

        function deleteTopic(id) {
            if (confirm('Are you sure you want to delete this topic and all its revisions?')) {
                topics = topics.filter(topic => topic.id !== id);
                localStorage.setItem('topics', JSON.stringify(topics));
                renderCalendar();
                checkTodaysRevisions();
                initProgressChart();
                updateTimelineChart();
                renderTodoList();
                renderBacklog();
                alert(' Topic deleted successfully!');
            }
        }

        function renderCalendar() {
            calendar.innerHTML = '';
            currentMonth.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const daysInMonth = lastDay.getDate();
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayNames.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day';
                dayHeader.style.fontWeight = 'bold';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            for (let i = 0; i < firstDay.getDay(); i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendar.appendChild(emptyDay);
            }
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                if (date.getTime() === today.getTime()) dayElement.classList.add('current');
                dayElement.dataset.date = date.toISOString();
                dayElement.addEventListener('click', (e) => {
                    if (!dayElement.querySelector('.day-number')) return;
                    openDateTopicsModal(new Date(dayElement.dataset.date));
                });
                const revisionTopics = getRevisionsForDate(date);
                if (revisionTopics.length > 0) {
                    dayElement.classList.add('revision');
                    const dotsContainer = document.createElement('div');
                    dotsContainer.className = 'revision-dots';
                    revisionTopics.forEach(topic => {
                        const dot = document.createElement('div');
                        dot.className = `revision-dot dot-${topic.subject}`;
                        dotsContainer.appendChild(dot);
                    });
                    dayElement.appendChild(dotsContainer);
                }
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayElement.appendChild(dayNumber);
                calendar.appendChild(dayElement);
            }
        }

        function getRevisionsForDate(date) {
            const revisions = [];
            const dateString = date.toDateString();
            topics.forEach(topic => {
                topic.revisionDates.forEach((revDate, index) => {
                    if (new Date(revDate).toDateString() === dateString && !topic.completedRevisions[index]) {
                        revisions.push({ subject: topic.subject, topicName: topic.topicName });
                    }
                });
            });
            return revisions;
        }

        function openDateTopicsModal(date) {
            const revisions = getRevisionsForDate(date);
            dateTopicsList.innerHTML = '';
            selectedDateDisplay.textContent = date.toLocaleDateString();
            if (revisions.length === 0) {
                const noMsg = document.createElement('div');
                noMsg.className = 'no-topics-message';
                noMsg.innerHTML = '<i class="fas fa-calendar-times"></i><div>No topics scheduled for this date.</div>';
                dateTopicsList.appendChild(noMsg);
            } else {
                revisions.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'date-topic-item';
                    itemEl.style.borderColor = getSubjectColor(item.subject);
                    const subjectEl = document.createElement('div');
                    subjectEl.className = 'date-topic-subject';
                    subjectEl.textContent = subjects[item.subject] ? subjects[item.subject].name : item.subject;
                    const nameEl = document.createElement('div');
                    nameEl.className = 'date-topic-name';
                    nameEl.textContent = item.topicName;
                    const infoEl = document.createElement('div');
                    infoEl.className = 'date-topic-info';
                    infoEl.innerHTML = '<div class="date-topic-revision">Revision scheduled</div>';
                    itemEl.appendChild(subjectEl);
                    itemEl.appendChild(nameEl);
                    itemEl.appendChild(infoEl);
                    itemEl.addEventListener('click', () => {
                        closeDateTopicsModal();
                        const match = Array.from(document.querySelectorAll('.todo-item')).find(el => el.querySelector('.todo-topic') && el.querySelector('.todo-topic').textContent.trim() === item.topicName);
                        if (match) {
                            match.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            match.classList.add('highlight');
                            setTimeout(() => match.classList.remove('highlight'), 1800);
                        }
                    });
                    dateTopicsList.appendChild(itemEl);
                });
            }
            dateTopicsModal.classList.add('active');
        }

        function closeDateTopicsModal() {
            dateTopicsModal.classList.remove('active');
        }

        function getSubjectColor(subjectKey) {
            const map = {
                math: '#4cc9f0',
                reasoning: '#f72585',
                english: '#4895ef',
                gk: '#7209b7',
                computer: '#3a0ca3',
                banking: '#38b000',
                custom: '#6c757d'
            };
            return map[subjectKey] || '#6c757d';
        }

        closeDateTopics.addEventListener('click', closeDateTopicsModal);
        dateTopicsModal.addEventListener('click', (e) => {
            if (!e.target.closest('.date-topics-content')) closeDateTopicsModal();
        });

        function showPreviousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function showNextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function initProgressChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const totalRevisions = topics.length * 5;
            let completedRevisions = 0;
            topics.forEach(topic => {
                topic.completedRevisions.forEach(completed => {
                    if (completed) completedRevisions++;
                });
            });
            if (window.progressChartInstance) window.progressChartInstance.destroy();
            window.progressChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Remaining'],
                    datasets: [{
                        data: [completedRevisions, totalRevisions - completedRevisions],
                        backgroundColor: ['rgba(67, 97, 238, 0.8)', 'rgba(226, 232, 240, 0.8)'],
                        borderColor: ['rgba(67, 97, 238, 1)', 'rgba(226, 232, 240, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: isDarkThemeActive() ? '#ffffff' : '#000000', font: { size: 12 } }
                        },
                        tooltip: {
                            callbacks: { label: function(context) { return `${context.label}: ${context.raw} revisions`; } }
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        function initDetailedProgressChart() {
            const ctx = document.getElementById('detailedProgressChart').getContext('2d');
            const today = new Date();
            const dates = [];
            const completedData = [];
            const scheduledData = [];
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                dates.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
                let completed = 0;
                let scheduled = 0;
                topics.forEach(topic => {
                    topic.revisionDates.forEach((revDate, index) => {
                        const revisionDate = new Date(revDate);
                        revisionDate.setHours(0, 0, 0, 0);
                        if (revisionDate.getTime() === date.getTime()) {
                            scheduled++;
                            if (topic.completedRevisions[index]) completed++;
                        }
                    });
                });
                completedData.push(completed);
                scheduledData.push(scheduled);
            }
            if (window.detailedProgressChartInstance) window.detailedProgressChartInstance.destroy();
            window.detailedProgressChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Completed Revisions',
                            data: completedData,
                            backgroundColor: 'rgba(67, 97, 238, 0.8)',
                            borderColor: 'rgba(67, 97, 238, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Scheduled Revisions',
                            data: scheduledData,
                            backgroundColor: 'rgba(114, 9, 183, 0.8)',
                            borderColor: 'rgba(114, 9, 183, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top', labels: { color: isDarkThemeActive() ? '#ffffff' : '#000000' } }
                    },
                    scales: {
                        x: {
                            grid: { color: isDarkThemeActive() ? '#444444' : '#e0e0e0' },
                            ticks: { color: isDarkThemeActive() ? '#ffffff' : '#000000', maxTicksLimit: 10 }
                        },
                        y: {
                            beginAtZero: true,
                            grid: { color: isDarkThemeActive() ? '#444444' : '#e0e0e0' },
                            ticks: { color: isDarkThemeActive() ? '#ffffff' : '#000000' }
                        }
                    }
                }
            });
        }

        function initTimelineChart(days = 7, selectedSubjects = []) {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            if (selectedSubjects.length === 0) {
                selectedSubjects = Object.keys(subjects);
                document.querySelectorAll('#subjectFilters input[type="checkbox"]').forEach(checkbox => checkbox.checked = true);
            }
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const dates = [];
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                dates.push(date);
            }
            const subjectData = {};
            const subjectColors = {
                math: '#4cc9f0',
                reasoning: '#f72585',
                english: '#4895ef',
                gk: '#7209b7',
                computer: '#3a0ca3',
                banking: '#38b000',
                custom: '#6c757d'
            };
            if (selectedSubjects.length === 0) selectedSubjects = Object.keys(subjects);
            selectedSubjects.forEach(subject => subjectData[subject] = new Array(days).fill(0));
            topics.forEach(topic => {
                if (selectedSubjects.includes(topic.subject)) {
                    topic.revisionDates.forEach((revDate, index) => {
                        if (topic.completedRevisions[index]) {
                            const revisionDate = new Date(revDate);
                            revisionDate.setHours(0, 0, 0, 0);
                            const dayIndex = dates.findIndex(d => d.getTime() === revisionDate.getTime());
                            if (dayIndex !== -1) subjectData[topic.subject][dayIndex] += 1;
                        }
                    });
                }
            });
            const datasets = [];
            selectedSubjects.forEach(subject => {
                datasets.push({
                    label: subjects[subject].name,
                    data: subjectData[subject],
                    borderColor: subjectColors[subject],
                    backgroundColor: subjectColors[subject] + '20',
                    tension: 0.4,
                    fill: false,
                    pointBackgroundColor: subjectColors[subject],
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: subjectColors[subject],
                    borderWidth: 2
                });
            });
            const formattedDates = dates.map(date => date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            if (window.timelineChartInstance) window.timelineChartInstance.destroy();
            window.timelineChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: formattedDates, datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Topics Completed',
                                font: { size: 14, weight: 'bold' },
                                color: isDarkThemeActive() ? '#ffffff' : '#000000'
                            },
                            grid: { color: isDarkThemeActive() ? '#444444' : '#e0e0e0' },
                            ticks: { color: isDarkThemeActive() ? '#ffffff' : '#000000', precision: 0 }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: { size: 14, weight: 'bold' },
                                color: isDarkThemeActive() ? '#ffffff' : '#000000'
                            },
                            grid: { color: isDarkThemeActive() ? '#444444' : '#e0e0e0' },
                            ticks: { color: isDarkThemeActive() ? '#ffffff' : '#000000' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Revision Timeline - Last ${days} Days`,
                            font: { size: (window.innerWidth <= 480 ? 14 : 18), weight: 'bold' },
                            color: isDarkThemeActive() ? '#ffffff' : '#000000',
                            padding: (window.innerWidth <= 480 ? 10 : 20)
                        },
                        legend: {
                            display: true,
                            labels: {
                                usePointStyle: true,
                                padding: (window.innerWidth <= 480 ? 8 : 20),
                                font: { size: (window.innerWidth <= 480 ? 10 : 12) },
                                color: isDarkThemeActive() ? '#ffffff' : '#000000'
                            }
                        },
                        tooltip: { enabled: false }
                    },
                    interaction: { intersect: false, mode: 'index' },
                    animation: { duration: 1000, easing: 'easeOutQuart' }
                }
            });
            function adjustTimelineChartForSize() {
                if (!window.timelineChartInstance) return;
                const small = window.innerWidth <= 480;
                window.timelineChartInstance.options.plugins.title.font.size = small ? 14 : 18;
                window.timelineChartInstance.options.plugins.title.padding = small ? 10 : 20;
                window.timelineChartInstance.options.plugins.legend.labels.font.size = small ? 10 : 12;
                window.timelineChartInstance.options.plugins.legend.labels.padding = small ? 8 : 20;
                if (window.timelineChartInstance.options.scales) {
                    if (window.timelineChartInstance.options.scales.x && window.timelineChartInstance.options.scales.x.ticks) {
                        window.timelineChartInstance.options.scales.x.ticks.font = { size: small ? 10 : 12 };
                    }
                    if (window.timelineChartInstance.options.scales.y && window.timelineChartInstance.options.scales.y.ticks) {
                        window.timelineChartInstance.options.scales.y.ticks.font = { size: small ? 10 : 12 };
                    }
                }
                window.timelineChartInstance.update();
            }
            adjustTimelineChartForSize();
            window.addEventListener('resize', adjustTimelineChartForSize);
        }

        function updateTimelineChart() {
            try {
                const activeBtn = document.querySelector('.filter-btn[data-days].active');
                const days = activeBtn ? parseInt(activeBtn.getAttribute('data-days')) : 7;
                const selectedSubjects = [];
                const subjectFiltersEl = document.getElementById('subjectFilters');
                if (subjectFiltersEl) {
                    subjectFiltersEl.querySelectorAll('input[data-subject]:checked').forEach(checkbox => {
                        selectedSubjects.push(checkbox.getAttribute('data-subject'));
                    });
                }
                if (selectedSubjects.length === 0) {
                    const allSubjectCheckboxes = subjectFiltersEl?.querySelectorAll('input[data-subject]');
                    if (allSubjectCheckboxes && allSubjectCheckboxes.length > 0) {
                        allSubjectCheckboxes.forEach(checkbox => selectedSubjects.push(checkbox.getAttribute('data-subject')));
                    }
                }
                if (selectedSubjects.length > 0) initTimelineChart(days, selectedSubjects);
            } catch (error) {
                console.error('Error updating timeline chart:', error);
            }
        }

        function initSubjectFilters() {
            subjectFilters.innerHTML = '';
            Object.keys(subjects).forEach(subject => {
                const label = document.createElement('label');
                label.innerHTML = `
                    <input type="checkbox" checked data-subject="${subject}">
                    <i class="${subjects[subject].icon}" style="color: ${subjects[subject].color}; margin-right: 5px;"></i>
                    ${subjects[subject].name}
                `;
                subjectFilters.appendChild(label);
            });
            subjectFilters.querySelectorAll('input[data-subject]').forEach(checkbox => {
                checkbox.addEventListener('change', updateTimelineChart);
            });
            document.querySelectorAll('.filter-btn[data-days]').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn[data-days]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    updateTimelineChart();
                });
            });
        }

        function toggleTimelineFilters() {
            timelineFilters.classList.toggle('active');
        }

        function checkTodaysRevisions() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todaysRevisions = [];
            topics.forEach(topic => {
                topic.revisionDates.forEach((revDate, index) => {
                    const revisionDate = new Date(revDate);
                    revisionDate.setHours(0, 0, 0, 0);
                    if (revisionDate.getTime() === today.getTime() && !topic.completedRevisions[index]) {
                        todaysRevisions.push({
                            id: topic.id,
                            subject: topic.subject,
                            subjectName: topic.subjectName,
                            topicName: topic.topicName,
                            revisionIndex: index
                        });
                    }
                });
            });
            if (todaysRevisions.length > 0) {
                let html = '<ul style="list-style: none; padding: 0;">';
                todaysRevisions.forEach(rev => {
                    html += `<li style="padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <strong>${rev.subjectName}:</strong> ${rev.topicName} <br>
                        <small style="color: var(--text-light);">Revision ${rev.revisionIndex + 1}</small>
                    </li>`;
                });
                html += '</ul>';
                todayRevisions.innerHTML = html;
            } else {
                todayRevisions.innerHTML = '<p style="color: var(--text-light);">No revisions scheduled for today. </p>';
            }
        }

        function renderTodoList() {
            if (topics.length === 0) {
                todoList.innerHTML = '<p style="color: var(--text-light);">No revisions scheduled. Add topics to get started. </p>';
                return;
            }
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            const upcomingRevisions = [];
            topics.forEach(topic => {
                topic.revisionDates.forEach((revDate, index) => {
                    const revisionDate = new Date(revDate);
                    revisionDate.setHours(0, 0, 0, 0);
                    if (revisionDate >= today && revisionDate <= nextWeek &&
                        (!topic.completedRevisions[index] || revisionDate.getTime() === today.getTime())) {
                        upcomingRevisions.push({
                            id: topic.id,
                            subject: topic.subject,
                            subjectName: topic.subjectName,
                            topicName: topic.topicName,
                            revisionIndex: index,
                            date: revisionDate,
                            completed: topic.completedRevisions[index]
                        });
                    }
                });
            });
            upcomingRevisions.sort((a, b) => a.date - b.date);
            if (upcomingRevisions.length === 0) {
                todoList.innerHTML = '<p style="color: var(--text-light);">No upcoming revisions in the next 7 days. Great! </p>';
                return;
            }
            let html = '<ul class="todo-list">';
            upcomingRevisions.forEach(rev => {
                const dateString = rev.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const isToday = rev.date.getTime() === today.getTime();
                const isFuture = rev.date.getTime() > today.getTime();
                html += `
                    <li class="todo-item ${isFuture ? 'future' : ''}">
                        <input type="checkbox" class="todo-checkbox" data-id="${rev.id}" data-index="${rev.revisionIndex}" ${rev.completed ? 'checked' : ''} ${isFuture ? 'disabled' : ''}>
                        <div class="todo-content">
                            <div class="todo-subject">${rev.subjectName}</div>
                            <div class="todo-topic">${rev.topicName}</div>
                            <div class="todo-revision">Revision ${rev.revisionIndex + 1}</div>
                        </div>
                        <div class="todo-date">${isToday ? 'Today' : dateString}</div>
                        <button class="delete-topic-btn" data-id="${rev.id}"></button>
                    </li>
                `;
            });
            html += '</ul>';
            todoList.innerHTML = html;
            document.querySelectorAll('.todo-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const index = parseInt(this.getAttribute('data-index'));
                    const topic = topics.find(t => t.id === id);
                    if (topic) {
                        topic.completedRevisions[index] = this.checked;
                        topic.lastCompletionDate = new Date();
                        localStorage.setItem('topics', JSON.stringify(topics));
                        if (this.checked) showCongratulations(topic, index);
                        checkTodaysRevisions();
                        initProgressChart();
                        initDetailedProgressChart();
                        updateTimelineChart();
                        renderTodoList();
                        renderBacklog();
                    }
                });
            });
            document.querySelectorAll('.todo-content').forEach(content => {
                content.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const todoItem = this.closest('.todo-item');
                    const checkbox = todoItem.querySelector('.todo-checkbox');
                    if (checkbox && !checkbox.disabled) {
                        checkbox.checked = !checkbox.checked;
                        checkbox.dispatchEvent(new Event('change', { bubbles: true }));
                    }
                });
            });
            document.querySelectorAll('.todo-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (!e.target.closest('.delete-topic-btn')) {
                        const checkbox = this.querySelector('.todo-checkbox');
                        if (checkbox && !checkbox.disabled && !e.target.closest('.todo-checkbox')) {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change', { bubbles: true }));
                        }
                    }
                });
            });
            document.querySelectorAll('.delete-topic-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTopic(id);
                });
            });
        }

        function renderBacklog() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const backlogRevisions = [];
            topics.forEach(topic => {
                topic.revisionDates.forEach((revDate, index) => {
                    const revisionDate = new Date(revDate);
                    revisionDate.setHours(0, 0, 0, 0);
                    if (revisionDate < today && !topic.completedRevisions[index]) {
                        backlogRevisions.push({
                            id: topic.id,
                            subject: topic.subject,
                            subjectName: topic.subjectName,
                            topicName: topic.topicName,
                            revisionIndex: index,
                            date: revisionDate,
                            completed: topic.completedRevisions[index]
                        });
                    }
                });
            });
            backlogRevisions.sort((a, b) => a.date - b.date);
            if (backlogRevisions.length === 0) {
                backlogSection.classList.add('hidden');
                backlogList.innerHTML = '<p style="color: var(--text-light);">No missed revisions. Great job! </p>';
                return;
            } else {
                backlogSection.classList.remove('hidden');
            }
            let html = '<ul class="todo-list">';
            backlogRevisions.forEach(rev => {
                const dateString = rev.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
                html += `
                    <li class="todo-item past-due">
                        <input type="checkbox" class="todo-checkbox" data-id="${rev.id}" data-index="${rev.revisionIndex}" ${rev.completed ? 'checked' : ''}>
                        <div class="todo-content">
                            <div class="todo-subject">${rev.subjectName}</div>
                            <div class="todo-topic">${rev.topicName}</div>
                            <div class="todo-revision">Revision ${rev.revisionIndex + 1}</div>
                        </div>
                        <div class="todo-date">${dateString}</div>
                        <button class="delete-topic-btn" data-id="${rev.id}"></button>
                    </li>
                `;
            });
            html += '</ul>';
            backlogList.innerHTML = html;
            document.querySelectorAll('#backlogList .todo-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    const index = parseInt(this.getAttribute('data-index'));
                    const topic = topics.find(t => t.id === id);
                    if (topic) {
                        topic.completedRevisions[index] = this.checked;
                        topic.lastCompletionDate = new Date();
                        localStorage.setItem('topics', JSON.stringify(topics));
                        if (this.checked) showCongratulations(topic, index);
                        checkTodaysRevisions();
                        initProgressChart();
                        updateTimelineChart();
                        renderTodoList();
                        renderBacklog();
                    }
                });
            });
            document.querySelectorAll('#backlogList .delete-topic-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.getAttribute('data-id'));
                    deleteTopic(id);
                });
            });
        }

        function renderProgressHistory() {
            const today = new Date();
            const lastMonth = new Date(today);
            lastMonth.setDate(today.getDate() - 30);
            let html = '<ul style="list-style: none; padding: 0;">';
            const recentRevisions = [];
            topics.forEach(topic => {
                topic.revisionDates.forEach((revDate, index) => {
                    const revisionDate = new Date(revDate);
                    if (revisionDate >= lastMonth && revisionDate <= today) {
                        recentRevisions.push({
                            topic: topic,
                            revisionIndex: index,
                            date: revisionDate,
                            completed: topic.completedRevisions[index]
                        });
                    }
                });
            });
            recentRevisions.sort((a, b) => b.date - a.date);
            if (recentRevisions.length === 0) {
                html += '<li style="padding: 10px; color: var(--text-light);">No revision activity in the last 30 days. Start now! </li>';
            } else {
                recentRevisions.forEach(rev => {
                    const dateString = rev.date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                    const status = rev.completed ?
                        `<span style="color: var(--success);"> Completed</span>` :
                        `<span style="color: var(--warning);"> Pending</span>`;
                    html += `
                        <li style="padding: 10px; border-bottom: 1px solid var(--border);">
                            <div><strong>${rev.topic.subjectName}: ${rev.topic.topicName}</strong></div>
                            <div>Revision ${rev.revisionIndex + 1} - ${dateString} - ${status}</div>
                        </li>
                    `;
                });
            }
            html += '</ul>';
            progressHistory.innerHTML = html;
        }

        function checkForNotification() {
            const today = new Date().toDateString();
            if (localStorage.getItem('notificationShownDate') === today) return;
            const todaysRevisions = getRevisionsForDate(new Date());
            if (todaysRevisions.length > 0) {
                let message = ` You have ${todaysRevisions.length} revision(s) today:\n\n`;
                todaysRevisions.forEach(rev => {
                    message += ` ${rev.subjectName}: ${rev.topicName}\n`;
                });
                message += `\nTap "Go to Revisions" to start! `;
                notificationMessage.textContent = message;
                notificationModal.classList.add('active');
                localStorage.setItem('notificationShownDate', today);
            }
        }

        function closeNotification() {
            notificationModal.classList.remove('active');
        }

        function goToRevisions() {
            notificationModal.classList.remove('active');
            document.querySelector('.dashboard').scrollIntoView({ behavior: 'smooth' });
        }

        function flipFlashcard() {
            flashcard.classList.toggle('flipped');
        }

        function showPrevFlashcard() {
            if (currentFlashcardIndex > 0) {
                currentFlashcardIndex--;
                updateFlashcard();
            }
        }

        function showNextFlashcard() {
            if (currentFlashcardIndex < flashcards.length - 1) {
                currentFlashcardIndex++;
                updateFlashcard();
            }
        }

        function updateFlashcard() {
            const card = flashcards[currentFlashcardIndex];
            flashcardTitle.textContent = card.title;
            flashcardBackTitle.textContent = card.title;
            flashcardContent.textContent = card.content;
            flashcardCounter.textContent = `${currentFlashcardIndex + 1}/${flashcards.length}`;
            flashcard.classList.remove('flipped');
            prevFlashcard.disabled = currentFlashcardIndex === 0;
            nextFlashcard.disabled = currentFlashcardIndex === flashcards.length - 1;
        }

        function showCongratulations(topic, revisionIndex) {
            congratulationsMessage.textContent = `Great job completing revision ${revisionIndex + 1} of "${topic.topicName}"! Keep up the good work. `;
            congratulations.classList.add('active');
        }

        function closeCongratulationsFunc() {
            congratulations.classList.remove('active');
        }

        function scheduleDailyNotification() {
            if (window.notificationTimeout) clearTimeout(window.notificationTimeout);
            const now = new Date();
            const [hours, minutes] = notificationTimeValue.split(':').map(Number);
            const target = new Date();
            target.setHours(hours, minutes, 0, 0);
            if (now > target) target.setDate(target.getDate() + 1);
            const timeUntilNotification = target.getTime() - now.getTime();
            window.notificationTimeout = setTimeout(() => {
                const todaysRevisions = getRevisionsForDate(new Date());
                if (todaysRevisions.length > 0 && 'Notification' in window && Notification.permission === 'granted') {
                    let body = ` You have ${todaysRevisions.length} revision(s) today:\n`;
                    todaysRevisions.slice(0, 3).forEach(rev => body += ` ${rev.topicName}\n`);
                    if (todaysRevisions.length > 3) body += `... and more!`;
                    body += `\nOpen RATTAFICATION to review! `;
                    const notification = new Notification(' RATTAFICATION - Revision Time!', {
                        body: body,
                        icon: 'https://image2url.com/images/1764554818460-19e359ab-8fba-416d-b135-b4295f0cfbfb.png',
                        badge: 'https://image2url.com/images/1764554818460-19e359ab-8fba-416d-b135-b4295f0cfbfb.png',
                        vibrate: [200, 100, 200],
                        tag: 'rattafication-daily-reminder'
                    });
                    notification.onclick = function() {
                        window.focus();
                        this.close();
                    };
                }
                scheduleDailyNotification();
            }, timeUntilNotification);
        }

        function checkAutoRemoval() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const lastAutoRemoval = localStorage.getItem('lastAutoRemoval');
            if (lastAutoRemoval === today.toDateString()) return;
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            topics = topics.filter(topic => {
                const allCompleted = topic.completedRevisions.every(completed => completed);
                if (allCompleted && topic.lastCompletionDate) {
                    const lastCompletion = new Date(topic.lastCompletionDate);
                    lastCompletion.setHours(0, 0, 0, 0);
                    if (lastCompletion <= yesterday) return false;
                }
                return true;
            });
            localStorage.setItem('topics', JSON.stringify(topics));
            localStorage.setItem('lastAutoRemoval', today.toDateString());
            renderTodoList();
            renderBacklog();
            initProgressChart();
            updateTimelineChart();
        }

        function setupEventListeners() {
            startBtn.addEventListener('click', startApp);
            menuBtn.addEventListener('click', toggleDrawer);
            drawerCancel.addEventListener('click', toggleDrawer);
            dashboardLink.addEventListener('click', closeDrawerAndGoToDashboard);
            subjectSelect.addEventListener('change', handleSubjectChange);
            chapterSelect.addEventListener('change', handleChapterChange);
            addTopicBtn.addEventListener('click', addTopic);
            prevMonthBtn.addEventListener('click', showPreviousMonth);
            nextMonthBtn.addEventListener('click', showNextMonth);
            aboutLink.addEventListener('click', showAbout);
            doubtsLink.addEventListener('click', showDoubts);
            goToMenuFromAbout.addEventListener('click', goBackToMenu);
            goToMenuFromDoubts.addEventListener('click', goBackToMenu);
            settingsLink.addEventListener('click', showSettings);
            progressLink.addEventListener('click', showProgressModal);
            shareAppLink.addEventListener('click', showShareModal);
            notificationLater.addEventListener('click', closeNotification);
            notificationGo.addEventListener('click', goToRevisions);
            copyLinkBtn.addEventListener('click', copyShareLink);
            closeShareModal.addEventListener('click', closeShareModalFunc);
            closeProgress.addEventListener('click', closeProgressModal);
            flashcard.addEventListener('click', flipFlashcard);
            prevFlashcard.addEventListener('click', showPrevFlashcard);
            nextFlashcard.addEventListener('click', showNextFlashcard);
            closeCongratulations.addEventListener('click', closeCongratulationsFunc);
            selectIconBtn.addEventListener('click', openIconModal);
            selectIconBtn.addEventListener('touchend', openIconModal);
            selectPicBtn.addEventListener('click', openPictureSelection);
            selectPicBtn.addEventListener('touchend', openPictureSelection);
            cancelIconSelect.addEventListener('click', closeIconModal);
            cancelIconSelect.addEventListener('touchend', closeIconModal);
            confirmIconSelect.addEventListener('click', confirmIconSelection);
            confirmIconSelect.addEventListener('touchend', confirmIconSelection);
            cancelCrop.addEventListener('click', cancelCropping);
            cancelCrop.addEventListener('touchend', cancelCropping);
            confirmCrop.addEventListener('click', confirmCropping);
            confirmCrop.addEventListener('touchend', confirmCropping);
            zoomInBtn.addEventListener('click', zoomIn);
            zoomOutBtn.addEventListener('click', zoomOut);
            zoomSlider.addEventListener('input', handleZoomSlider);
            cropperContainer.addEventListener('mousedown', startDrag);
            cropperContainer.addEventListener('mousemove', moveDrag);
            cropperContainer.addEventListener('mouseup', endDrag);
            cropperContainer.addEventListener('mouseleave', endDrag);
            cropperContainer.addEventListener('touchstart', startDrag);
            cropperContainer.addEventListener('touchmove', moveDrag);
            cropperContainer.addEventListener('touchend', endDrag);
            closeSettings.addEventListener('click', closeSettingsModal);
            saveNotificationTime.addEventListener('click', saveNotificationTimeFunc);
            changeAvatarBtn.addEventListener('click', openAvatarChange);
            uploadPicSettingsBtn.addEventListener('click', openPictureSelectionFromSettings);
            saveUserSettings.addEventListener('click', saveUserSettingsFunc);
            resetAppBtn.addEventListener('click', openResetConfirmModal);
            cancelReset.addEventListener('click', closeResetConfirmModal);
            confirmReset.addEventListener('click', performAppReset);
            resetConfirmInput.addEventListener('input', validateResetInput);
            timelineFilterToggle.addEventListener('click', toggleTimelineFilters);
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    applyTheme(theme);
                    document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    localStorage.setItem('currentTheme', theme);
                });
            });
            document.querySelectorAll('.share-option').forEach(option => {
                option.addEventListener('click', function() {
                    const platform = this.getAttribute('data-platform');
                    shareOnPlatform(platform);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
